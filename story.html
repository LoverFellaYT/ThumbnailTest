<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StoryCraft Analyzer - Craft Viral Hits!</title>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnH/PRRZ9i6Lkxy/lK+Ad+Qw3PweIIsXgTn5N2sA3ZgP6L6YKn42pPZLNSQNkI3b7HlFj5pAg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Styles -->
    <style>
      :root {
        --primary-light: #4facfe;
        --accent-light: #00f2fe;
        --bg-light: #f9fafb;
        --text-light: #1e293b;
        --panel-light: rgba(255, 255, 255, 0.96);
        --border-light: rgba(255, 255, 255, 0.2);
        --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        --transition: all 0.2s ease;
        --radius: 14px;
        --gradient-light: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-light) 100%);
        --spacing: 1rem;
        --font-base: 'Poppins', sans-serif;
        --table-cell-bg-light: rgba(255, 255, 255, 0.85);
        --section-bg: rgba(79, 172, 254, 0.2);
        --highlight: #ff6b6b; /* Vibrant accent color */
      }
      html[data-theme="dark"] {
        --bg-light: #1f1f1f;
        --text-light: #f3f3f3;
        --panel-light: rgba(18, 18, 18, 0.98);
        --border-light: rgba(255, 255, 255, 0.2);
        --gradient-light: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --table-cell-bg-light: rgba(30, 30, 30, 0.85);
        --section-bg: rgba(79, 172, 254, 0.3);
      }

      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-base);
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px), var(--bg-light);
        background-size: 30px 30px;
        color: var(--text-light);
        transition: var(--transition);
      }

      /* Hero Section */
      .hero {
        text-align: center;
        padding: 3rem 1rem;
        background: var(--gradient-light);
        color: #fff;
        border-radius: 0 0 var(--radius) var(--radius);
        box-shadow: var(--shadow);
      }
      .hero h1 {
        font-size: 2.5rem;
        margin: 0;
        font-weight: 700;
        animation: fadeIn 1s ease-in;
      }
      .hero p {
        font-size: 1.2rem;
        margin: 0.5rem 0 1.5rem;
      }
      .hero .btn {
        font-size: 1.2rem;
        padding: 0.8rem 2rem;
        animation: bounce 2s infinite;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
      }

      /* How It Works Section */
      .how-it-works {
        max-width: 1100px;
        margin: 2rem auto;
        display: flex;
        justify-content: space-around;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .step {
        flex: 1;
        min-width: 200px;
        text-align: center;
        padding: 1rem;
      }
      .step h3 {
        color: var(--primary-light);
        margin: 0.5rem 0;
      }

      /* Layout Container */
      .layout-container {
        display: flex;
        align-items: flex-start;
        width: 98%;
        max-width: 1100px;
        margin: 2rem auto;
        gap: 1rem;
      }

      /* Sticky Header */
      header.analyzer-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 1.5rem 2rem;
        margin: 0 auto var(--spacing);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        max-width: 1100px;
        width: 98%;
      }
      .header-left h1 {
        font-size: 2rem;
        margin: 0;
        font-weight: 700;
      }
      .score-info p {
        margin: 0.2rem 0;
        font-size: 0.9rem;
      }
      .progress-container {
        width: 200px;
        height: 16px;
        background: #ccc;
        border-radius: 5px;
        overflow: hidden;
        margin-top: 0.3rem;
      }
      #progressBar {
        height: 100%;
        background: var(--gradient-light);
        width: 0%;
        transition: width 0.3s;
      }

      /* Buttons */
      button.btn {
        background: var(--gradient-light);
        color: #fff;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 6px rgba(126, 34, 206, 0.2);
      }
      button.btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(126, 34, 206, 0.4);
      }

      /* Glass Panels */
      .glass-panel {
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        padding: 2.5rem;
        margin: 2rem 0;
        text-align: center;
      }
      .glass-panel h2 {
        color: var(--highlight);
      }

      aside#ideaRubricSection {
        width: 400px;
        flex-shrink: 0;
      }
      #ideaRubricUpload {
        width: 90%;
        margin-top: 1rem;
      }
      #ideaRubricImageContainer {
        margin-top: 1rem;
        overflow-x: auto;
      }
      #ideaRubricImageContainer img {
        border-radius: var(--radius);
        display: block;
        max-width: none;
      }

      .main-content {
        flex: 1;
      }

      .story-input {
        width: 80%;
        max-width: 800px;
        margin: 0.5rem auto;
        min-height: 120px;
        padding: 1rem;
        border: 2px solid var(--border-light);
        border-radius: var(--radius);
        font-size: 1rem;
        background: var(--bg-light);
        resize: none;
        transition: var(--transition);
        color: var(--text-light);
      }
      html[data-theme="dark"] .story-input {
        color: #fff;
      }
      .story-input:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
      }

      input[type="text"] {
        padding: 0.5rem;
        width: 70%;
        border: 2px solid var(--border-light);
        border-radius: var(--radius);
      }

      .similar-videos-list {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
      }
      .video-thumbnail {
        width: 200px;
        overflow: hidden;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
      }
      .video-thumbnail img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        display: block;
      }
      .video-title {
        padding: 0.5rem;
        font-size: 0.9rem;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0 4px;
        line-height: 1;
      }
      .video-thumbnail:hover {
        transform: scale(1.02);
      }

      /* Rubric Table */
      .rubric-table {
        margin: 1rem 0;
      }
      .modern-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }
      .modern-table th {
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        text-align: left;
        position: sticky;
        top: 0;
        backdrop-filter: blur(10px);
        z-index: 10;
        background: var(--gradient-light);
        color: #fff;
      }
      .modern-table th:nth-child(2) { background: #f87171; color: #fff; }
      .modern-table th:nth-child(3) { background: #fb923c; color: #fff; }
      .modern-table th:nth-child(4) { background: #facc15; color: #000; }
      .modern-table th:nth-child(5) { background: #4ade80; color: #fff; }
      .modern-table td {
        padding: 0.75rem 1.5rem;
        background: var(--table-cell-bg-light);
        border-bottom: 1px solid rgba(0,0,0,0.05);
        transition: var(--transition);
        vertical-align: top;
      }
      .modern-table td:hover:not(.category-header) {
        background: rgba(224, 231, 255, 0.3);
      }
      .modern-table td.selected {
        background: rgba(224, 231, 255, 0.5) !important;
        border-left: 4px solid var(--primary-light);
      }
      .category-header {
        font-weight: 600;
        background: rgba(79, 172, 254, 0.03);
        position: sticky;
        left: 0;
        min-width: 160px;
      }

      .section-header {
        text-align: center;
        font-weight: bold;
        background: var(--section-bg);
        padding: 0.75rem 0;
      }

      #selfAssessmentSection ul {
        list-style-type: none;
        padding: 0;
        margin: 0 auto;
        max-width: 600px;
        text-align: left;
      }
      #selfAssessmentSection li {
        margin-bottom: 0.5rem;
      }
      #selfAssessmentSection li label {
        cursor: pointer;
      }

      /* Social Share Section */
      .social-share {
        text-align: center;
        padding: 1rem;
      }
      .social-btn {
        background: none;
        border: none;
        font-size: 2rem;
        margin: 0 1rem;
        cursor: pointer;
        transition: var(--transition);
      }
      .social-btn:hover {
        transform: scale(1.2);
        color: var(--highlight);
      }

      @media (max-width: 768px) {
        .layout-container {
          flex-direction: column;
          align-items: flex-start;
        }
        aside#ideaRubricSection {
          width: 100%;
          margin-bottom: 1rem;
        }
        .main-content {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Hero Section -->
    <section class="hero">
      <h1>StoryCraft Analyzer</h1>
      <p>Score your story ideas and turn them into viral hits for YouTube & Roblox!</p>
      <button class="btn" onclick="document.getElementById('quickSummarySection').scrollIntoView({behavior: 'smooth'})">
        Start Crafting Now!
      </button>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
      <div class="step">
        <h3>1. Summarize Your Idea</h3>
        <p>Write a quick pitch for your story or video concept.</p>
      </div>
      <div class="step">
        <h3>2. Score with Rubric</h3>
        <p>Use our detailed rubric to rate its potential.</p>
      </div>
      <div class="step">
        <h3>3. Export & Share</h3>
        <p>Download your analysis and share it with friends!</p>
      </div>
    </section>

    <!-- HEADER -->
    <header class="analyzer-header">
      <div class="header-left">
        <h1>StoryCraft Analyzer</h1>
        <div class="score-info">
          <p>Total Score: <span id="total">0</span> / 56</p>
          <p>Ranking: <span id="ranking">Incomplete</span></p>
          <div class="progress-container">
            <div id="progressBar"></div>
          </div>
        </div>
      </div>
      <div class="header-right">
        <button class="btn" id="resetBtn">🔄 Reset</button>
        <button class="btn" id="exportBtn">🖼️ Export PNG</button>
        <button class="btn" id="rainbowBtn">🌈 Tips</button>
        <div class="dark-mode">
          <label class="toggle-label" for="darkModeToggle">
            <input type="checkbox" id="darkModeToggle" aria-label="Toggle Dark Mode" />
            <div class="dark-mode-slider">
              <span class="mode-label">☀️</span>
              <span class="mode-label">🌙</span>
              <div class="slider-thumb"></div>
            </div>
          </label>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main>
      <div class="layout-container">
        <!-- Left Column: "Idea Rubric" -->
        <aside class="glass-panel" id="ideaRubricSection">
          <h2>Idea Rubric</h2>
          <p>Upload a PNG sketch (e.g., Roblox concept art):</p>
          <input type="file" id="ideaRubricUpload" accept="image/png" />
          <div id="ideaRubricImageContainer"></div>
        </aside>

        <!-- Right Column: Main Content -->
        <div class="main-content">
          <!-- Quick Summary Section -->
          <div class="glass-panel input-section" id="quickSummarySection">
            <h2>📝 Quick Summary</h2>
            <textarea id="quickSummary" class="story-input" placeholder="Example: 'I hatch 1000 eggs in Pet Simulator 99 to find a legendary pet!'"></textarea>
          </div>

          <!-- Similar Videos Section -->
          <div class="glass-panel input-section" id="similarVideosSection">
            <h2>📺 Similar Videos</h2>
            <input type="text" id="youtubeLinkInput" placeholder="Enter YouTube video URL..." />
            <button class="btn" id="addVideoBtn">Add Video</button>
            <div id="similarVideosList" class="similar-videos-list"></div>
          </div>

          <!-- Rubric Table Section -->
          <div class="glass-panel rubric-table" id="rubricSection">
            <h2>📊 Rubric Table</h2>
            <table class="modern-table">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Good (1)</th>
                  <th>Great (2)</th>
                  <th>Excellent (3)</th>
                  <th>Outstanding (4)</th>
                </tr>
              </thead>
              <tbody>
                <!-- SECTION: Video Concept & Pre Planning -->
                <tr>
                  <td colspan="5" class="section-header">VIDEO CONCEPT & PRE PLANNING</td>
                </tr>
                <!-- 1) Video Concept -->
                <tr>
                  <td class="category-header" data-category="0">🎬 Video Concept</td>
                  <td data-category="0" data-rating="1">Weak or unoriginal concept; doesn’t stand out.</td>
                  <td data-category="0" data-rating="2">Decent concept with some originality, but still feels familiar.</td>
                  <td data-category="0" data-rating="3">Strong concept with a unique twist that draws interest.</td>
                  <td data-category="0" data-rating="4">Highly compelling and innovative concept; stands out instantly.</td>
                </tr>
                <!-- 2) Planning & Outline -->
                <tr>
                  <td class="category-header" data-category="1">📝 Planning & Outline</td>
                  <td data-category="1" data-rating="1">Concept is loosely formed; unclear breakdown of key elements (hook, conflict, CTA, etc.).</td>
                  <td data-category="1" data-rating="2">Basic structure or progression is outlined but lacks detail in some areas.</td>
                  <td data-category="1" data-rating="3">Well‐conceived plan with a thorough script or breakdown ensuring each segment ties into the main goal.</td>
                  <td data-category="1" data-rating="4">Comprehensive pre‐production that accounts for hooking device, escalations, pacing, and seamless goal integration.</td>
                </tr>
                <!-- 3) Production Feasibility & Planning -->
                <tr>
                  <td class="category-header" data-category="2">🎥 Production Feasibility & Planning</td>
                  <td data-category="2" data-rating="1">Unrealistic or vague plan with potential production obstacles.</td>
                  <td data-category="2" data-rating="2">Basic plan exists but lacks thorough logistics (locations, timing, assets).</td>
                  <td data-category="2" data-rating="3">Well-thought-out plan with production logistics considered.</td>
                  <td data-category="2" data-rating="4">Comprehensive pre-production, including contingency plans and efficient scheduling.</td>
                </tr>
                <!-- 4) Retention-Based Structure -->
                <tr>
                  <td class="category-header" data-category="3">📈 Retention-Based Structure</td>
                  <td data-category="3" data-rating="1">No clear plan for keeping viewers engaged.</td>
                  <td data-category="3" data-rating="2">Some engaging points, but may have weak retention structure.</td>
                  <td data-category="3" data-rating="3">Pacing and retention elements are mapped out effectively.</td>
                  <td data-category="3" data-rating="4">Highly structured for retention with peaks, suspense, and pacing mapped minute-by-minute.</td>
                </tr>
                <!-- 5) Originality & Trend‐Jacking -->
                <tr>
                  <td class="category-header" data-category="4">🚀 Originality & Trend‐Jacking</td>
                  <td data-category="4" data-rating="1">Overdone or cliché concept with no unique spin.</td>
                  <td data-category="4" data-rating="2">Minor twist on popular trends but still somewhat familiar.</td>
                  <td data-category="4" data-rating="3">A distinct approach or fresh angle that helps it stand out.</td>
                  <td data-category="4" data-rating="4">Boundary‐pushing content or trend usage that feels truly innovative.</td>
                </tr>

                <!-- SECTION: Video Fundamentals -->
                <tr>
                  <td colspan="5" class="section-header">VIDEO FUNDAMENTALS</td>
                </tr>
                <!-- 6) Hook & Intro -->
                <tr>
                  <td class="category-header" data-category="5">🎣 Hook & Intro</td>
                  <td data-category="5" data-rating="1">Slow start or unclear hook; doesn’t entice immediate engagement.</td>
                  <td data-category="5" data-rating="2">Basic but functional hook; viewers might stay out of mild curiosity.</td>
                  <td data-category="5" data-rating="3">Clear, intriguing opening that sparks immediate interest.</td>
                  <td data-category="5" data-rating="4">Unignorable opener; compels viewers to keep watching almost instantly.</td>
                </tr>
                <!-- 7) Clarity of Goal -->
                <tr>
                  <td class="category-header" data-category="6">🎯 Clarity of Goal</td>
                  <td data-category="6" data-rating="1">Goal is vague, hidden, or tacked on; viewers may not know why they’re watching.</td>
                  <td data-category="6" data-rating="2">A stated goal exists but can get lost or muddled mid‐video.</td>
                  <td data-category="6" data-rating="3">The central goal is well‐defined, and each segment clearly ties back to it.</td>
                  <td data-category="6" data-rating="4">Crystal‐clear premise; the entire video revolves around a high‐stakes goal that viewers can’t wait to see resolved.</td>
                </tr>
                <!-- 8) Conflict & Stakes -->
                <tr>
                  <td class="category-header" data-category="7">⚔️ Conflict & Stakes</td>
                  <td data-category="7" data-rating="1">Low urgency; conflicts feel trivial or manufactured.</td>
                  <td data-category="7" data-rating="2">Basic obstacles are present but feel predictable.</td>
                  <td data-category="7" data-rating="3">High stakes that keep viewers invested in how events will unfold.</td>
                  <td data-category="7" data-rating="4">Unavoidable drama and ever‐escalating tension that compels viewers to see the outcome.</td>
                </tr>
                <!-- 9) Challenges & Obstacles -->
                <tr>
                  <td class="category-header" data-category="8">🛑 Challenges & Obstacles</td>
                  <td data-category="8" data-rating="1">Challenges feel artificial, forced, or too easy.</td>
                  <td data-category="8" data-rating="2">Some obstacles exist but feel predictable.</td>
                  <td data-category="8" data-rating="3">Well-balanced challenges that create tension and excitement.</td>
                  <td data-category="8" data-rating="4">Dynamic, unpredictable challenges that elevate engagement.</td>
                </tr>
                <!-- 10) Credibility & Believability -->
                <tr>
                  <td class="category-header" data-category="9">🤝 Credibility & Believability</td>
                  <td data-category="9" data-rating="1">Feels forced or overly staged; viewer trust may be low.</td>
                  <td data-category="9" data-rating="2">Some genuine elements, but parts still come off as artificial or scripted.</td>
                  <td data-category="9" data-rating="3">The content feels sincere and honest; overall sense of integrity.</td>
                  <td data-category="9" data-rating="4">Deeply credible; the creator’s transparency and approach leave no doubt about authenticity.</td>
                </tr>

                <!-- SECTION: Video Pacing -->
                <tr>
                  <td colspan="5" class="section-header">VIDEO PACING</td>
                </tr>
                <!-- 11) Pacing & Rhythm -->
                <tr>
                  <td class="category-header" data-category="10">⏱️ Pacing & Rhythm</td>
                  <td data-category="10" data-rating="1">Uneven pacing; segments linger too long or abruptly cut.</td>
                  <td data-category="10" data-rating="2">Mostly smooth transitions but with occasional slow or rushed sections.</td>
                  <td data-category="10" data-rating="3">Generally well‐paced with clear transitions and strong narrative rhythm.</td>
                  <td data-category="10" data-rating="4">Flawless pacing; each section transitions effortlessly, sustaining tension or momentum at all times.</td>
                </tr>
                <!-- 12) Retention-Based Structure -->
                <tr>
                  <td class="category-header" data-category="11">📈 Retention-Based Structure</td>
                  <td data-category="11" data-rating="1">No clear plan for keeping viewers engaged.</td>
                  <td data-category="11" data-rating="2">Some engaging points, but may have weak retention structure.</td>
                  <td data-category="11" data-rating="3">Pacing and retention elements are mapped out effectively.</td>
                  <td data-category="11" data-rating="4">Highly structured for retention with peaks, suspense, and pacing mapped minute-by-minute.</td>
                </tr>
                <!-- 13) Storytelling & Emotional Investment -->
                <tr>
                  <td class="category-header" data-category="12">📖 Storytelling & Emotional Investment</td>
                  <td data-category="12" data-rating="1">No emotional stakes; the audience may not care about the outcome.</td>
                  <td data-category="12" data-rating="2">Basic stakes are present, but they may feel predictable or unearned.</td>
                  <td data-category="12" data-rating="3">Strong emotional connection; the audience is invested in the journey.</td>
                  <td data-category="12" data-rating="4">Deep emotional pull with well-executed character arcs or stakes.</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Human Feedback Section -->
          <div class="glass-panel input-section" id="humanFeedbackSection">
            <h2>👥 Human Feedback</h2>
            <textarea id="humanFeedback" class="story-input" placeholder="Add your own notes—like how it fits Roblox trends!" style="min-height: 100px;"></textarea>
          </div>

          <!-- Self-Assessment Checklist Section -->
          <div class="glass-panel input-section" id="selfAssessmentSection">
            <h2>✅ Self-Assessment Checklist</h2>
            <ul>
              <li>
                <input type="checkbox" id="check1" />
                <label for="check1"><strong>Pre-Writing:</strong> Is the theme, central conflict, and structure (e.g., Save the Cat, Story Circle) clearly defined?</label>
              </li>
              <li>
                <input type="checkbox" id="check2" />
                <label for="check2"><strong>Writing:</strong> Do beats connect logically (“And, But, Therefore”), and are resolutions character-driven rather than coincidental?</label>
              </li>
              <li>
                <input type="checkbox" id="check3" />
                <label for="check3"><strong>World-Building & Stakes:</strong> Are mechanics, rules, and stakes clear and consistent? Do conflicts escalate meaningfully?</label>
              </li>
              <li>
                <input type="checkbox" id="check4" />
                <label for="check4"><strong>Review:</strong> Does the story flow smoothly, with no unnecessary complexity? Do all setups and subplots tie into the resolution?</label>
              </li>
              <li>
                <input type="checkbox" id="check5" />
                <label for="check5"><strong>Polishing:</strong> Have weak beats, plot holes, and unearned resolutions (e.g., deus ex machina) been removed?</label>
              </li>
              <li>
                <input type="checkbox" id="check6" />
                <label for="check6"><strong>Pre-Shoot:</strong> Is everything (set, props, equipment, talent, backups) fully prepared for filming?</label>
              </li>
            </ul>
          </div>
        </div> <!-- end .main-content -->
      </div> <!-- end .layout-container -->
    </main>

    <!-- Social Share -->
    <section class="social-share">
      <p>Share your analysis!</p>
      <button class="social-btn" onclick="shareOnTwitter()">🐦</button>
      <button class="social-btn" onclick="shareOnDiscord()">💬</button>
    </section>

    <!-- JavaScript -->
    <script>
      // Global variables
      let scores = {};

      window.addEventListener('DOMContentLoaded', () => {
        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('change', toggleTheme);

        // Buttons
        document.getElementById('exportBtn').addEventListener('click', exportPNG);
        document.getElementById('rainbowBtn').addEventListener('click', showRainbowQuote);
        document.getElementById('resetBtn').addEventListener('click', resetScores);
        document.getElementById('addVideoBtn').addEventListener('click', addYouTubeVideo);

        // Rubric clicking
        document.querySelectorAll('.modern-table td[data-rating]').forEach(cell => {
          cell.addEventListener('click', () => selectRating(cell));
        });

        // Auto-resize textareas
        document.querySelectorAll('.story-input').forEach(textarea => {
          textarea.addEventListener('input', autoResize);
        });

        // Idea Rubric upload
        document.getElementById('ideaRubricUpload').addEventListener('change', handleIdeaRubricUpload);
      });

      function handleIdeaRubricUpload(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.type.match('image/png')) {
          alert('Please upload a PNG file.');
          return;
        }

        const reader = new FileReader();
        reader.onload = function(evt) {
          const container = document.getElementById('ideaRubricImageContainer');
          container.innerHTML = `<img src="${evt.target.result}" alt="Idea Rubric" />`;
        };
        reader.readAsDataURL(file);
      }

      function showRainbowQuote() {
        const quotes = [
          "For Roblox: Make it wild—like hatching a pet that takes over the game!",
          "Viral Tip: Add a twist no one sees coming.",
          "Keep viewers hooked with escalating stakes!",
          "Simple stories with big payoffs win every time.",
          "Test your idea: Would YOU click this thumbnail?"
        ];
        const randomIndex = Math.floor(Math.random() * quotes.length);
        alert(quotes[randomIndex]);
      }

      function selectRating(cell) {
        const categoryIndex = Number(cell.getAttribute('data-category'));
        const rating = parseInt(cell.getAttribute('data-rating'));
        const row = cell.parentElement;
        row.querySelectorAll('td').forEach(td => {
          if (td !== row.firstElementChild) td.classList.remove('selected');
        });
        cell.classList.add('selected');
        scores[categoryIndex] = rating;
        updateTotal();
      }

      function updateTotal() {
        const total = Object.values(scores).reduce((a, b) => a + b, 0);
        document.getElementById('total').textContent = total;
        const ranking = document.getElementById('ranking');
        if (Object.keys(scores).length < 10) {
          ranking.textContent = 'Incomplete';
          ranking.style.color = '#64748b';
          updateProgressBar(total);
          return;
        }
        if (total < 21) {
          ranking.textContent = 'Needs Work 🔴';
          ranking.style.color = 'red';
        } else if (total < 32) {
          ranking.textContent = 'Good Start 🟡';
          ranking.style.color = 'orange';
        } else if (total < 40) {
          ranking.textContent = 'Great! 🟢';
          ranking.style.color = 'green';
        } else {
          ranking.textContent = 'Perfect! 🔵';
          ranking.style.color = 'blue';
          if (typeof confetti === 'function') {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
          }
        }
        updateProgressBar(total);
      }

      function updateProgressBar(total) {
        const maxScore = 56; // Updated to match rubric total
        const percentage = (total / maxScore) * 100;
        document.getElementById("progressBar").style.width = percentage + "%";
      }

      function autoResize(e) {
        const textarea = e.target;
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
      }

      async function exportPNG() {
        const tempContainer = document.createElement('div');
        tempContainer.style.position = 'absolute';
        tempContainer.style.top = '-9999px';
        tempContainer.style.left = '-9999px';
        tempContainer.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-light');
        tempContainer.style.padding = "1rem";

        const headerClone = document.querySelector('header.analyzer-header').cloneNode(true);
        headerClone.style.position = 'static';
        headerClone.style.top = '0';
        headerClone.style.margin = '0';

        const layoutClone = document.querySelector('.layout-container').cloneNode(true);

        tempContainer.appendChild(headerClone);
        tempContainer.appendChild(layoutClone);
        document.body.appendChild(tempContainer);

        try {
          const canvas = await html2canvas(tempContainer, { scale: 2, useCORS: true });
          const dataUrl = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'storycraft-analysis.png';
          link.href = dataUrl;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        } catch (error) {
          console.error('PNG export failed:', error);
          alert('Error exporting PNG. Please try again.');
        }
        document.body.removeChild(tempContainer);
      }

      function resetScores() {
        scores = {};
        document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
        document.getElementById('quickSummary').value = '';
        document.getElementById('humanFeedback').value = '';
        document.getElementById('ranking').textContent = 'Incomplete';
        document.getElementById('ranking').style.color = '#64748b';
        document.getElementById('similarVideosList').innerHTML = '';
        document.getElementById('total').textContent = 0;
        document.getElementById('progressBar').style.width = '0%';
      }

      function toggleTheme(e) {
        if (e.target.checked) {
          document.documentElement.setAttribute("data-theme", "dark");
        } else {
          document.documentElement.removeAttribute("data-theme");
        }
      }

      function addYouTubeVideo() {
        const urlInput = document.getElementById('youtubeLinkInput');
        const url = urlInput.value.trim();
        if (!url) return;

        let videoId = "";
        try {
          const urlObj = new URL(url);
          if (urlObj.hostname === "youtu.be") {
            videoId = urlObj.pathname.slice(1);
          } else if (urlObj.searchParams.get("v")) {
            videoId = urlObj.searchParams.get("v");
          }
        } catch (err) {
          alert("Invalid URL");
          return;
        }
        if (!videoId) {
          alert("Could not extract YouTube video ID.");
          return;
        }

        const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
        const videoList = document.getElementById('similarVideosList');

        const videoContainer = document.createElement('div');
        videoContainer.className = 'video-thumbnail';

        const img = document.createElement('img');
        img.src = thumbnailUrl;
        videoContainer.appendChild(img);

        const title = document.createElement('div');
        title.className = 'video-title';
        title.textContent = `Video ID: ${videoId}`;
        videoContainer.appendChild(title);

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '×';
        removeBtn.addEventListener('click', () => {
          videoList.removeChild(videoContainer);
        });
        videoContainer.appendChild(removeBtn);

        videoList.appendChild(videoContainer);

        urlInput.value = '';
      }

      function shareOnTwitter() {
        const score = document.getElementById('total').textContent;
        const ranking = document.getElementById('ranking').textContent;
        const text = `I scored ${score}/56 on StoryCraft Analyzer! Ranking: ${ranking}. Check out my viral idea: ${document.getElementById('quickSummary').value.substring(0, 100)}...`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
      }

      function shareOnDiscord() {
        const score = document.getElementById('total').textContent;
        const summary = document.getElementById('quickSummary').value.substring(0, 100);
        alert(`Copy this to Discord:\nMy StoryCraft Score: ${score}/56\nIdea: ${summary}...`);
      }
    </script>
  </body>
</html>
