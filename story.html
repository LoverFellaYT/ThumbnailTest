<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StoryCraft Analyzer Pro+ Enhanced</title>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnH/PRRZ9i6Lkxy/lK+Ad+Qw3PweIIsXgTn5N2sA3ZgP6L6YKn42pPZLNSQNkI3b7HlFj5pAg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Google Font: Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Styles -->
    <style>
      /* --------------------------------------------------------------
         CSS Variables & Base Styles
         -------------------------------------------------------------- */
      :root {
        --primary-light: #4facfe;
        --accent-light: #00f2fe;
        --bg-light: #f9fafb;
        --text-light: #1e293b;
        --panel-light: rgba(255, 255, 255, 0.96);
        --border-light: rgba(255, 255, 255, 0.2);
        --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        --transition: all 0.2s ease;
        --radius: 14px;
        --gradient-light: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-light) 100%);
        --spacing: 1rem;
        --font-base: 'Roboto', sans-serif;
        --table-cell-bg-light: rgba(255, 255, 255, 0.85);
      }
      /* Dark mode variables */
      html[data-theme="dark"] {
        --bg-light: #1f1f1f;
        --text-light: #f3f3f3;
        --panel-light: rgba(18, 18, 18, 0.98);
        --border-light: rgba(255, 255, 255, 0.2);
        --gradient-light: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --table-cell-bg-light: rgba(30, 30, 30, 0.85);
      }
      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-base);
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px),
          var(--bg-light);
        background-size: 30px 30px;
        color: var(--text-light);
        transition: var(--transition);
      }
      .analyzer-container {
        width: 95%;
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 var(--spacing) 2rem;
        text-align: center;
      }
      /* --------------------------------------------------------------
         Header / Sticky Banner
         -------------------------------------------------------------- */
      header.analyzer-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 1.5rem 2rem;
        margin-bottom: var(--spacing);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        animation: headerGlow 3s infinite alternate;
      }
      @keyframes headerGlow {
        from { box-shadow: 0 0 10px rgba(255,215,0,0.5); }
        to { box-shadow: 0 0 30px rgba(255,215,0,1); }
      }
      .header-left {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        text-align: center;
      }
      /* Main heading added to header */
      .main-heading {
        font-size: 2rem;
        margin: 0;
        font-weight: bold;
      }
      .total-score {
        font-size: 1.75rem;
        font-weight: 700;
        background: var(--gradient-light);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      /* The header now displays the score as "Score: 0/40 Incomplete" directly */
      .progress-bar-container {
        width: 100%;
        height: 10px;
        background: #eee;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }
      .progress-bar {
        height: 100%;
        width: 0%;
        background: var(--gradient-light);
        transition: width 0.3s ease;
      }
      .status-indicator {
        font-weight: 600;
      }
      .header-right {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: center;
      }
      /* --------------------------------------------------------------
         Button Styling (Using .btn)
         -------------------------------------------------------------- */
      button.btn {
        background: var(--gradient-light);
        color: #fff;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 6px rgba(126, 34, 206, 0.2);
      }
      button.btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(126, 34, 206, 0.4);
      }
      /* --------------------------------------------------------------
         Dark Mode Toggle Styles
         -------------------------------------------------------------- */
      .dark-mode {
        display: inline-flex;
        align-items: center;
      }
      .toggle-label {
        cursor: pointer;
        display: inline-flex;
        align-items: center;
      }
      .dark-mode-slider {
        position: relative;
        width: 60px;
        height: 30px;
        background-color: #e0e0e0;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 5px;
        transition: background-color 0.3s;
      }
      .dark-mode-slider .mode-label {
        font-size: 16px;
      }
      .dark-mode-slider .slider-thumb {
        position: absolute;
        width: 26px;
        height: 26px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.3s;
      }
      input#darkModeToggle {
        display: none;
      }
      input#darkModeToggle:checked + .dark-mode-slider .slider-thumb {
        transform: translateX(30px);
      }
      input#darkModeToggle:checked + .dark-mode-slider {
        background-color: var(--primary-light);
      }
      /* --------------------------------------------------------------
         Glass Panels for Sections
         -------------------------------------------------------------- */
      .glass-panel {
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        padding: 2rem;
        margin: 1rem 0;
        text-align: center;
      }
      .glass-panel h2 {
        margin-top: 0;
        text-align: center;
      }
      /* --------------------------------------------------------------
         Input Areas & Textarea Styling
         -------------------------------------------------------------- */
      .input-section {
        margin: 0.5rem 0;
      }
      .story-input {
        width: 100%;
        min-height: 80px;
        padding: 0.5rem;
        border: 2px solid var(--border-light);
        border-radius: var(--radius);
        font-size: 1rem;
        background: var(--bg-light);
        resize: none;
        transition: var(--transition);
        margin-bottom: 0.5rem;
        text-align: left;
      }
      .story-input:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
      }
      input[type="text"] {
        padding: 0.5rem;
        width: 70%;
        border: 2px solid var(--border-light);
        border-radius: var(--radius);
        text-align: left;
      }
      /* --------------------------------------------------------------
         Similar Videos Section
         -------------------------------------------------------------- */
      .similar-videos-list {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
        justify-content: center;
      }
      .video-thumbnail {
        width: 200px;
        overflow: hidden;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
      }
      .video-thumbnail img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        display: block;
      }
      .video-title {
        padding: 0.5rem;
        font-size: 0.9rem;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .remove-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 1.2rem;
        padding: 0 4px;
        line-height: 1;
      }
      .video-thumbnail:hover {
        transform: scale(1.02);
      }
      /* --------------------------------------------------------------
         Rubric Table Styling
         -------------------------------------------------------------- */
      .rubric-table {
        overflow-x: auto;
        margin: 1rem 0;
      }
      .modern-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        min-width: 800px;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
      }
      .modern-table th,
      .modern-table td {
        padding: 0.5rem 1rem;
        text-align: center;
      }
      .modern-table th {
        font-weight: 500;
        position: sticky;
        top: 0;
        backdrop-filter: blur(10px);
        z-index: 10;
        background: var(--gradient-light);
        color: #fff;
      }
      .modern-table th:nth-child(2) { background: #f87171; color: #fff; }
      .modern-table th:nth-child(3) { background: #fb923c; color: #fff; }
      .modern-table th:nth-child(4) { background: #facc15; color: #000; }
      .modern-table th:nth-child(5) { background: #4ade80; color: #fff; }
      .modern-table td {
        background: var(--table-cell-bg-light);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        vertical-align: middle;
      }
      /* Hover animations on rubric options */
      .modern-table td[data-rating]:hover:not(.selected) {
        background: rgba(224, 231, 255, 0.4);
        transform: scale(1.05);
      }
      .modern-table td.selected {
        background: rgba(224, 231, 255, 0.5) !important;
        border-left: 4px solid var(--primary-light);
      }
      .category-header {
        font-weight: 600;
        background: rgba(79, 172, 254, 0.03);
        position: sticky;
        left: 0;
        min-width: 180px;
      }
      /* --------------------------------------------------------------
         Self-Assessment Checklist Styling
         -------------------------------------------------------------- */
      #selfAssessmentSection ul {
        list-style-type: none;
        padding: 0;
        margin: 0 auto;
        max-width: 600px;
        text-align: left;
      }
      #selfAssessmentSection li {
        margin-bottom: 0.5rem;
      }
      #selfAssessmentSection li label {
        cursor: pointer;
      }
      @media (max-width: 768px) {
        header.analyzer-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .header-right {
          margin-top: 1rem;
          width: 100%;
          justify-content: space-around;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER / Sticky Banner -->
    <header class="analyzer-header">
      <div class="header-left">
        <!-- Main Heading Added -->
        <h1 class="main-heading">StoryCraft Analyzer</h1>
        <div class="total-score">
          Score: <span id="total">0</span>/40 <span id="scoreLabel">Incomplete</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="status-indicator" id="ranking">Incomplete</div>
      </div>
      <div class="header-right">
        <button class="btn" onclick="resetScores()">üîÑ Reset</button>
        <button class="btn" onclick="exportPNG()">üñºÔ∏è Export PNG</button>
        <div class="dark-mode">
          <label class="toggle-label" for="darkModeToggle">
            <input type="checkbox" id="darkModeToggle" onchange="toggleTheme(this)" aria-label="Toggle Dark Mode" />
            <div class="dark-mode-slider">
              <span class="mode-label">‚òÄÔ∏è</span>
              <span class="mode-label">üåô</span>
              <div class="slider-thumb"></div>
            </div>
          </label>
        </div>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main>
      <div class="analyzer-container">
        <!-- Quick Summary Section -->
        <div class="glass-panel input-section" id="quickSummarySection">
          <h2>üìù Quick Summary</h2>
          <textarea id="quickSummary" class="story-input" placeholder="Summarize the story or video in a few lines..."></textarea>
        </div>
        <!-- Similar Videos Section -->
        <div class="glass-panel input-section" id="similarVideosSection">
          <h2>üì∫ Similar Videos</h2>
          <input type="text" id="youtubeLinkInput" placeholder="Enter YouTube video URL..." />
          <button class="btn" onclick="addYouTubeVideo()">Add Video</button>
          <div id="similarVideosList" class="similar-videos-list"></div>
        </div>
        <!-- Rubric Table Section -->
        <div class="glass-panel rubric-table" id="rubricSection">
          <h2>üìä Rubric Table</h2>
          <table class="modern-table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Good (1)</th>
                <th>Great (2)</th>
                <th>Excellent (3)</th>
                <th>Outstanding (4)</th>
              </tr>
            </thead>
            <tbody>
              <!-- 1. Hook & Opening -->
              <tr>
                <td class="category-header" data-category="0" title="The opener should immediately grab attention.">üé£ Hook &amp; Opening</td>
                <td data-category="0" data-rating="1">Slow start or unclear hook; doesn‚Äôt entice immediate engagement.</td>
                <td data-category="0" data-rating="2">Basic but functional hook; viewers might stay out of mild curiosity.</td>
                <td data-category="0" data-rating="3">Clear, intriguing opening that sparks immediate interest.</td>
                <td data-category="0" data-rating="4">Unignorable opener; compels viewers to keep watching almost instantly.</td>
              </tr>
              <!-- 2. Clarity of Goal -->
              <tr>
                <td class="category-header" data-category="1" title="A clear goal keeps the narrative focused.">üéØ Clarity of Goal</td>
                <td data-category="1" data-rating="1">Goal is vague, hidden, or tacked on; viewers may not know why they‚Äôre watching.</td>
                <td data-category="1" data-rating="2">A stated goal exists but can get lost or muddled mid‚Äêvideo.</td>
                <td data-category="1" data-rating="3">The central goal is well‚Äêdefined, and each segment clearly ties back to it.</td>
                <td data-category="1" data-rating="4">Crystal‚Äêclear premise; the entire video revolves around a high‚Äêstakes goal that viewers can‚Äôt wait to see resolved.</td>
              </tr>
              <!-- 3. Audience Retention -->
              <tr>
                <td class="category-header" data-category="2" title="Maintaining audience engagement is key.">üëÄ Audience Retention</td>
                <td data-category="2" data-rating="1">Loses viewer interest quickly; minimal hooks throughout.</td>
                <td data-category="2" data-rating="2">A few engaging points or ‚Äúspikes‚Äù but inconsistent pacing or lulls.</td>
                <td data-category="2" data-rating="3">Strong pacing, timely reveals, and mini‚Äêcliffhangers sustain attention.</td>
                <td data-category="2" data-rating="4">Nearly no dead spots; viewers are consistently teased with reasons to stay.</td>
              </tr>
              <!-- 4. Conflict & Stakes -->
              <tr>
                <td class="category-header" data-category="3" title="Conflict drives engagement.">‚öîÔ∏è Conflict &amp; Stakes</td>
                <td data-category="3" data-rating="1">Low urgency; conflicts feel trivial or manufactured.</td>
                <td data-category="3" data-rating="2">Basic obstacles are present but can feel predictable.</td>
                <td data-category="3" data-rating="3">High stakes that keep viewers invested in how events will unfold.</td>
                <td data-category="3" data-rating="4">Unavoidable drama and ever‚Äêescalating tension that compels viewers to see the outcome.</td>
              </tr>
              <!-- 5. CTA & Audience Interaction -->
              <tr>
                <td class="category-header" data-category="4" title="Calls to action drive viewer participation.">üì¢ CTA &amp; Audience Interaction</td>
                <td data-category="4" data-rating="1">Weak or generic CTA (‚Äúlike/subscribe‚Äù) with no real urgency.</td>
                <td data-category="4" data-rating="2">Standard CTA that matches typical platform norms.</td>
                <td data-category="4" data-rating="3">Creative or timely CTA that spurs actual viewer response (e.g., poll, question).</td>
                <td data-category="4" data-rating="4">Emotionally compelling, strategic CTA that feels integrated and inspires strong audience participation.</td>
              </tr>
              <!-- 6. Originality & Trend‚ÄêJacking -->
              <tr>
                <td class="category-header" data-category="5" title="Unique angles set you apart.">üí° Originality &amp; Trend‚ÄêJacking</td>
                <td data-category="5" data-rating="1">Overdone or clich√© concept with no unique spin.</td>
                <td data-category="5" data-rating="2">Minor twist on popular trends but still somewhat familiar.</td>
                <td data-category="5" data-rating="3">A distinct approach or fresh angle that helps it stand out.</td>
                <td data-category="5" data-rating="4">Boundary‚Äêpushing content or trend usage that feels truly innovative.</td>
              </tr>
              <!-- 7. Replayability & Shareability -->
              <tr>
                <td class="category-header" data-category="6" title="Encourages viewers to revisit or share.">üîÑ Replayability &amp; Shareability</td>
                <td data-category="6" data-rating="1">Forgettable; viewers likely wouldn‚Äôt watch again.</td>
                <td data-category="6" data-rating="2">Has a few moments worth revisiting or sharing.</td>
                <td data-category="6" data-rating="3">Highly shareable; the content encourages conversation or repeat views.</td>
                <td data-category="6" data-rating="4">Clip‚Äêworthy highlights that prompt viewers to share widely; huge viral potential.</td>
              </tr>
              <!-- 8. Credibility & Believability -->
              <tr>
                <td class="category-header" data-category="7" title="Authenticity builds trust.">ü§ù Credibility &amp; Believability</td>
                <td data-category="7" data-rating="1">Feels forced or overly staged; viewer trust may be low.</td>
                <td data-category="7" data-rating="2">Some genuine elements, but parts still come off as artificial or scripted.</td>
                <td data-category="7" data-rating="3">The content feels sincere and honest; overall sense of integrity.</td>
                <td data-category="7" data-rating="4">Deeply credible; the creator‚Äôs transparency and approach leave no doubt about authenticity.</td>
              </tr>
              <!-- 9. Production & Editing Quality -->
              <tr>
                <td class="category-header" data-category="8" title="Quality enhances the viewing experience.">üé¨ Production &amp; Editing Quality</td>
                <td data-category="8" data-rating="1">Technical flaws distract (poor audio, inconsistent lighting, messy cuts).</td>
                <td data-category="8" data-rating="2">Generally serviceable production with occasional rough spots.</td>
                <td data-category="8" data-rating="3">Clean, creative editing and good production values that enhance the content.</td>
                <td data-category="8" data-rating="4">Cinematic or highly stylized editing; seamless technical quality that elevates the overall experience.</td>
              </tr>
              <!-- 10. Pacing & Rhythm -->
              <tr>
                <td class="category-header" data-category="9" title="Smooth pacing holds viewer attention.">‚è© Pacing &amp; Rhythm</td>
                <td data-category="9" data-rating="1">Uneven pacing; segments linger too long or abruptly cut.</td>
                <td data-category="9" data-rating="2">Mostly smooth transitions but with occasional slow or rushed sections.</td>
                <td data-category="9" data-rating="3">Generally well‚Äêpaced with clear transitions and strong narrative rhythm.</td>
                <td data-category="9" data-rating="4">Flawless pacing; each section transitions effortlessly, sustaining tension or momentum at all times.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Self-Assessment Checklist Section -->
        <div class="glass-panel input-section" id="selfAssessmentSection">
          <h2>‚úÖ Self-Assessment Checklist</h2>
          <ul>
            <li>
              <input type="checkbox" id="check1" />
              <label for="check1"><strong>Hook:</strong> Does the opening grab attention in the first few seconds?</label>
            </li>
            <li>
              <input type="checkbox" id="check2" />
              <label for="check2"><strong>Goal:</strong> Is the main objective/challenge clearly defined?</label>
            </li>
            <li>
              <input type="checkbox" id="check3" />
              <label for="check3"><strong>Conflict &amp; Stakes:</strong> Are obstacles and stakes high enough to keep viewers invested?</label>
            </li>
            <li>
              <input type="checkbox" id="check4" />
              <label for="check4"><strong>Structure:</strong> Does the story flow logically from setup to escalation to resolution?</label>
            </li>
            <li>
              <input type="checkbox" id="check5" />
              <label for="check5"><strong>Audience Retention Hooks:</strong> Have you planned moments or reveals that keep viewers from clicking away?</label>
            </li>
            <li>
              <input type="checkbox" id="check6" />
              <label for="check6"><strong>Credibility &amp; Believability:</strong> Do plot points and scenarios feel authentic, not forced?</label>
            </li>
            <li>
              <input type="checkbox" id="check7" />
              <label for="check7"><strong>CTA or Interaction Point:</strong> Is there a clear moment where you invite audience participation (like, comment, etc.)?</label>
            </li>
            <li>
              <input type="checkbox" id="check8" />
              <label for="check8"><strong>Uniqueness:</strong> Do you offer something fresh or tap into current trends in a new way?</label>
            </li>
            <li>
              <input type="checkbox" id="check9" />
              <label for="check9"><strong>Pacing:</strong> Does each scene/segment have a strong reason to exist without dragging?</label>
            </li>
            <li>
              <input type="checkbox" id="check10" />
              <label for="check10"><strong>Shareability:</strong> Is there a ‚Äúwow‚Äù factor or memorable highlight that encourages sharing?</label>
            </li>
          </ul>
        </div>
      </div>
    </main>

    <!-- JavaScript -->
    <script>
      // For the new 10-item rubric, maximum total = 10 x 4 = 40.
      let scores = {};

      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.modern-table td[data-rating]').forEach(cell => {
          cell.addEventListener('click', () => selectRating(cell));
        });
        document.querySelectorAll('.story-input').forEach(textarea => {
          textarea.addEventListener('input', autoResize);
        });
      });

      function selectRating(cell) {
        const categoryIndex = Number(cell.getAttribute('data-category'));
        const rating = parseInt(cell.getAttribute('data-rating'));
        const row = cell.parentElement;
        // Remove "selected" class from all other cells in this row
        row.querySelectorAll('td').forEach(td => {
          if (td !== row.firstElementChild) td.classList.remove('selected');
        });
        cell.classList.add('selected');
        scores[categoryIndex] = rating;
        updateTotal();
      }

      function updateTotal() {
        const total = Object.values(scores).reduce((a, b) => a + b, 0);
        document.getElementById('total').textContent = total;
        const ranking = document.getElementById('ranking');
        // Only update ranking if all 10 categories have been rated
        if (Object.keys(scores).length < 10) {
          ranking.textContent = 'Incomplete';
          ranking.style.color = '#64748b';
          updateProgressBar(total);
          return;
        }
        // Thresholds based on a maximum score of 40:
        if (total < 21) {
          ranking.textContent = 'Needs Work üî¥';
          ranking.style.color = 'red';
        } else if (total < 30) {
          ranking.textContent = 'Good Start üü°';
          ranking.style.color = 'orange';
        } else if (total < 40) {
          ranking.textContent = 'Great! üü¢';
          ranking.style.color = 'green';
        } else {
          ranking.textContent = 'Perfect! üîµ';
          ranking.style.color = 'blue';
          if (typeof confetti === 'function') {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
          }
        }
        updateProgressBar(total);
      }

      function updateProgressBar(total) {
        // Update progress bar based on a max score of 40
        const percentage = (total / 40) * 100;
        document.getElementById("progressBar").style.width = percentage + "%";
      }

      function autoResize(e) {
        const textarea = e.target;
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
      }

      async function exportPNG() {
        const header = document.querySelector('header.analyzer-header');
        const originalPosition = header.style.position;
        header.style.position = 'static';
        const elements = [ header ];
        if (document.getElementById('quickSummary').value.trim() !== "") {
          elements.push(document.getElementById('quickSummarySection'));
        }
        if (document.getElementById('similarVideosList').childElementCount > 0) {
          elements.push(document.getElementById('similarVideosSection'));
        }
        if (Object.keys(scores).length > 0) {
          elements.push(document.getElementById('rubricSection'));
        }
        if (document.getElementById('humanFeedback').value.trim() !== "") {
          elements.push(document.getElementById('humanFeedbackSection'));
        }
        const tempContainer = document.createElement('div');
        tempContainer.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-light');
        tempContainer.style.padding = "1rem";
        elements.forEach(el => {
          const clone = el.cloneNode(true);
          tempContainer.appendChild(clone);
        });
        document.body.appendChild(tempContainer);
        try {
          const canvas = await html2canvas(tempContainer, { scale: 2, useCORS: true });
          const dataUrl = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'storycraft-analysis.png';
          link.href = dataUrl;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        } catch (error) {
          console.error('PNG export failed:', error);
          alert('Error exporting PNG. Please try again.');
        }
        tempContainer.remove();
        header.style.position = originalPosition;
      }

      function resetScores() {
        scores = {};
        document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
        ['quickSummary', 'humanFeedback'].forEach(id => {
          document.getElementById(id).value = '';
        });
        document.getElementById('ranking').textContent = 'Incomplete';
        document.getElementById('ranking').style.color = '#64748b';
        document.getElementById('similarVideosList').innerHTML = '';
      }

      function toggleTheme(input) {
        if (input.checked) {
          document.documentElement.setAttribute("data-theme", "dark");
        } else {
          document.documentElement.removeAttribute("data-theme");
        }
      }
    </script>
  </body>
</html>
