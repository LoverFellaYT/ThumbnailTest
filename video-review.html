              <tr data-group="g4">
                <td data-category="14" class="category-header"><strong>Teasers / Open Loops</strong></td>
                <td data-category="14" data-rating="1">
                  No hint of upcoming highlights<br>
                  No reason for viewers to stay
                </td>
                <td data-category="14" data-rating="2">
                  Brief mention of future excitement but underplayed<br>
                  Payoff feels disconnected or delayed
                </td>
                <td data-category="14" data-rating="3">
                  Sets up curiosity early and teases key moments<br>
                  Delivers on the promise later in the video
                </td>
                <td data-category="14" data-rating="4">
                  Multiple, well-timed teases and flash-forwards<br>
                  Hook and re-engage viewers until the climactic payoff
                </td>
              </tr>

              <!-- Section 5: Overall Polish (Categories 15-18) -->
              <tr class="section-header" data-group="g5">
                <td colspan="5">Overall Polish</td>
              </tr>
              <tr data-group="g5">
                <td data-category="15" class="category-header"><strong>Overall Engagement &amp; Polish</strong></td>
                <td data-category="15" data-rating="1">
                  Video loses interest quickly; obvious editing gaps<br>
                  Feels like raw footage with minimal polish
                </td>
                <td data-category="15" data-rating="2">
                  Watchable but lacks a “wow” factor<br>
                  Minor technical issues or rough transitions present
                </td>
                <td data-category="15" data-rating="3">
                  Smooth, cohesive video with good storytelling and technical polish<br>
                  Minimal errors and a professional feel
                </td>
                <td data-category="15" data-rating="4">
                  Engrossing from start to finish; technically flawless<br>
                  Exudes a high-end, “pro YouTuber” production quality
                </td>
              </tr>
              <tr data-group="g5">
                <td data-category="16" class="category-header"><strong>Surprise &amp; Unexpected</strong></td>
                <td data-category="16" data-rating="1">
                  Predictable flow with no unexpected edits or twists
                </td>
                <td data-category="16" data-rating="2">
                  Occasional surprises, but nothing that stands out
                </td>
                <td data-category="16" data-rating="3">
                  Deliberate inclusion of small surprises or comedic inserts<br>
                  Keeps the video feeling fresh
                </td>
                <td data-category="16" data-rating="4">
                  Packed with well-timed, organic surprises that reignite viewer excitement throughout
                </td>
              </tr>
              <tr data-group="g5">
                <td data-category="17" class="category-header"><strong>Tone &amp; Style Fit</strong></td>
                <td data-category="17" data-rating="1">
                  Editing style clashes with the channel’s personality<br>
                  Overly dramatic or too bland
                </td>
                <td data-category="17" data-rating="2">
                  Somewhat aligned but inconsistently executed<br>
                  Minor mismatches in tone
                </td>
                <td data-category="17" data-rating="3">
                  Editing style complements the content and creator’s personality<br>
                  Consistent mood throughout
                </td>
                <td data-category="17" data-rating="4">
                  Cohesive and unmistakable style that perfectly suits the content<br>
                  Viewers instantly recognize the polished brand identity
                </td>
              </tr>
              <tr data-group="g5">
                <td data-category="18" class="category-header"><strong>Technical Polish &amp; Finishing</strong></td>
                <td data-category="18" data-rating="1">
                  Frequent audio pops, glitchy transitions, and inconsistent color/volume<br>
                  Looks like a rough draft
                </td>
                <td data-category="18" data-rating="2">
                  Basic corrections applied but minor issues remain<br>
                  Some synchronization or export flaws
                </td>
                <td data-category="18" data-rating="3">
                  Clean, error-free timeline with proper color correction and audio mixing<br>
                  High-resolution export that looks professional
                </td>
                <td data-category="18" data-rating="4">
                  Impeccable finishing: zero stray frames, perfect crossfades, and flawless technical polish<br>
                  Expert use of editing tools for a refined final product
                </td>
              </tr>
            </tbody>
          </table>

          <button id="toggleLegend" onclick="toggleLegend()">Show Legend &amp; Definitions</button>
          <div id="legend">
            <h4>Legend &amp; Definitions</h4>
            <p><strong>Grouped by Section:</strong></p>
            <ul>
              <li><strong>Section 1: Story &amp; Structure (0–4)</strong></li>
              <li><strong>Section 2: Visual Engagement (5–7)</strong></li>
              <li><strong>Section 3: Audio (8–11)</strong></li>
              <li><strong>Section 4: Retention &amp; Pattern (12–14)</strong></li>
              <li><strong>Section 5: Overall Polish (15–18)</strong></li>
            </ul>
            <p>Click on a cell in each row that best describes the current level (1–4).</p>
            <h5>Rating Levels</h5>
            <ul>
              <li><strong>Needs Improvement (1):</strong> Major shortcomings.</li>
              <li><strong>Fair (2):</strong> Basic or acceptable.</li>
              <li><strong>Good (3):</strong> Solid quality.</li>
              <li><strong>Outstanding (4):</strong> Perfect performance.</li>
            </ul>
          </div>
        </section>

        <!-- FEEDBACK PANEL -->
        <section class="feedback-panel glass-panel" aria-labelledby="feedbackHeading">
          <h3 id="feedbackHeading">Feedback</h3>
          <div class="feedback-entry">
            <label for="humanFeedback">Human Feedback</label>
            <div id="humanFeedback" class="feedback-input" contenteditable="true" data-placeholder="Enter your human feedback here..." aria-label="Human Feedback"></div>
          </div>
        </section>
      </div>

      <!-- Review Checklist Section -->
      <section class="review-checklist" aria-labelledby="reviewChecklistHeading">
        <h3 id="reviewChecklistHeading">Review Checklist</h3>
        <ul>
          <li>
            <input type="checkbox" id="check1">
            <label for="check1">Does the opening grab attention and set the tone effectively?</label>
          </li>
          <li>
            <input type="checkbox" id="check2">
            <label for="check2">Is the pacing balanced with smooth transitions and clear progression?</label>
          </li>
          <li>
            <input type="checkbox" id="check3">
            <label for="check3">Are visual elements (on‑screen text, graphics, cutaways) clear and engaging?</label>
          </li>
          <li>
            <input type="checkbox" id="check4">
            <label for="check4">Does the audio (music and sound effects) complement the visuals and narrative?</label>
          </li>
          <li>
            <input type="checkbox" id="check5">
            <label for="check5">Is the overall narrative coherent with a strong flow?</label>
          </li>
          <li>
            <input type="checkbox" id="check6">
            <label for="check6">Are creative techniques used effectively to enhance viewer engagement?</label>
          </li>
          <li>
            <input type="checkbox" id="check7">
            <label for="check7">Is the technical quality (editing, resolution, color grading) top‑notch?</label>
          </li>
        </ul>
        <button class="btn" onclick="submitAssessment()">Submit Review Checklist</button>
        <div class="assessment-result" id="assessmentResult" aria-live="polite"></div>
      </section>

      <!-- FUN FACT SECTION (Bottom) -->
      <div class="fun-fact-section glass-panel" id="funFactSection" role="note" aria-live="polite">
        <!-- A random fun fact or tip will appear here -->
      </div>
    </main>

    <!-- HOW-TO MODAL -->
    <dialog class="modal-bg" id="howToModal" aria-labelledby="howToHeading" aria-modal="true">
      <div class="modal-content">
        <button class="close-btn" onclick="closeHowTo()" aria-label="Close How To">&times;</button>
        <h2 id="howToHeading">How to Use Editing Review Pro+</h2>
        <ul>
          <li>Click on the appropriate rating cell for each row in the rubric table.</li>
          <li>Your total score updates automatically (out of 84 maximum points).</li>
          <li>If any item is rated 1, the overall result is "Rejected."</li>
          <li>Read the daily Quote of Wisdom for inspiration.</li>
          <li>Provide additional feedback in the Human Feedback box.</li>
          <li>Use the Review Checklist to evaluate overall quality.</li>
          <li>When finished, you can reset scores or export the review as a PNG.</li>
        </ul>
      </div>
    </dialog>

    <!-- TUTORIAL MODAL -->
    <dialog class="modal-bg" id="tutorialModal" aria-labelledby="tutorialHeading" aria-modal="true">
      <div class="modal-content">
        <button class="close-btn" onclick="closeTutorial()" aria-label="Close Tutorial">&times;</button>
        <div id="tutorialContent"></div>
      </div>
    </dialog>

    <!-- Hidden Audio Elements for Sound Effects -->
    <audio id="victorySound" src="victory.mp3"></audio>
    <audio id="wompSound" src="womp.mp3"></audio>

    <!-- DISNEY MAGIC EASTER EGG ICON -->
    <div id="disneyMagic" title="Click for a little Disney Magic!">✨</div>

    <!-- JAVASCRIPT -->
    <script>
      /***************************************************
       * Global Variables & Emoji Mapping
       ***************************************************/
      let scoreData = {};
      let confettiShown = false;
      // Still 19 categories total (0..18)
      const maxCategories = 19;
      const maxPoints = 84;

      // Updated emoji mapping for categories 0..18
      const categoryEmojis = {
        0: '⚡',
        1: '🚀',
        2: '⏭️',
        3: '🎞️',
        4: '⏱️',
        5: '🖼️',
        6: '🧩',
        7: '🔍',
        8: '🎶',
        9: '💬',
        10: '🎵',
        11: '🔊',
        12: '📈',
        13: '📢',
        14: '❓',
        15: '💎',
        16: '🤯',
        17: '✨',
        18: '🎬'
      };

      // Returns the overall rating label and color for overall score
      function getRatingLabel(overallTotal) {
        if (overallTotal < 25) {
          return { scoreLabel: "Needs Work", rankingText: "Needs Work 🔴", color: "#ef4444" };
        } else if (overallTotal < 50) {
          return { scoreLabel: "Good", rankingText: "Good 🟢", color: "#22c55e" };
        } else if (overallTotal < 70) {
          return { scoreLabel: "Great", rankingText: "Great 🟡", color: "#eab308" };
        } else if (overallTotal < 80) {
          return { scoreLabel: "Excellent", rankingText: "Excellent 🟣", color: "#8b5cf6" };
        } else {
          return { scoreLabel: "Outstanding", rankingText: "Outstanding 🔵", color: "#3b82f6" };
        }
      }

      // Determine section rating based on average rating of the section
      function getSectionRating(average) {
        if (average < 2) {
          return { label: "Good", color: "#f87171" };
        } else if (average < 3) {
          return { label: "Great", color: "#fb923c" };
        } else if (average < 4) {
          return { label: "Excellent", color: "#facc15" };
        } else {
          return { label: "Outstanding", color: "#4ade80" };
        }
      }

      // Helper: convert hex color to rgba with given alpha
      function hexToRGBA(hex, alpha) {
        let r = parseInt(hex.slice(1, 3), 16);
        let g = parseInt(hex.slice(3, 5), 16);
        let b = parseInt(hex.slice(5, 7), 16);
        return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
      }

      /***************************************************
       * Initialization on DOMContentLoaded
       ***************************************************/
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize scoreData for categories 0..18
        for (let i = 0; i < maxCategories; i++) {
          scoreData[i] = 0;
        }

        // Add click listeners to all rating cells
        const ratingCells = document.querySelectorAll('td[data-rating]');
        ratingCells.forEach(cell => {
          cell.addEventListener('click', handleCellClick);
        });

        // Insert emojis into category header cells
        initEmojis();

        // Store original header text for each section header for later updates
        initSectionHeaders();

        // Call updateScore once so that overall and section scores display
        updateScore();

        // Set a random inspirational quote and fun fact
        randomQuote();
        randomFunFact();

        // Add a click listener to the Disney Magic icon
        document.getElementById('disneyMagic').addEventListener('click', onClickDisneyMagic);
      });

      /***************************************************
       * Event Handlers & UI Functions
       ***************************************************/

      // When a rating cell is clicked:
      function handleCellClick(event) {
        const cell = event.currentTarget;
        const category = cell.getAttribute('data-category');
        const rating = parseInt(cell.getAttribute('data-rating'));

        // Remove 'selected' from other cells in this row
        const row = cell.parentElement;
        const cells = row.querySelectorAll('td[data-rating]');
        cells.forEach(c => c.classList.remove('selected'));

        // Mark this cell as selected and update scoreData
        cell.classList.add('selected');
        scoreData[category] = rating;

        updateScore();
      }

      // Recalculate and update the overall score, then update section scores
      function updateScore() {
        let overallTotal = 0;
        for (let key in scoreData) {
          overallTotal += parseInt(scoreData[key]) || 0;
        }
        document.getElementById('scoreTotal').innerText = overallTotal;

        const ratingInfo = getRatingLabel(overallTotal);
        document.getElementById('scoreLabel').innerText = ratingInfo.scoreLabel;
        const rankingElem = document.getElementById('ranking');
        rankingElem.innerText = ratingInfo.rankingText;
        rankingElem.style.color = ratingInfo.color;

        // Update section scores
        updateSectionScores();

        // Launch confetti and play sound if overall score >= 80
        if (overallTotal >= 80 && !confettiShown) {
          launchConfetti();
          const victorySound = document.getElementById('victorySound');
          if (victorySound) {
            victorySound.play().catch(() => {});
          }
          confettiShown = true;
        } else if (overallTotal < 80) {
          confettiShown = false;
        }
      }

      // Clear all selections and reset the score
      function resetScores() {
        for (let i = 0; i < maxCategories; i++) {
          scoreData[i] = 0;
        }
        const ratingCells = document.querySelectorAll('td[data-rating]');
        ratingCells.forEach(cell => cell.classList.remove('selected'));
        updateScore();

        const wompSound = document.getElementById('wompSound');
        if (wompSound) {
          wompSound.play().catch(() => {});
        }
      }

      // Export the review section as a PNG using html2canvas
      function exportPNG() {
        const container = document.querySelector('.analyzer-container');
        if (!container) return;
        html2canvas(container).then(canvas => {
          const link = document.createElement('a');
          link.download = 'editing-review.png';
          link.href = canvas.toDataURL();
          link.click();
        }).catch(err => {
          console.error('Error exporting PNG:', err);
        });
      }

      // Toggle the Legend & Definitions
      function toggleLegend() {
        const legend = document.getElementById('legend');
        const toggleBtn = document.getElementById('toggleLegend');
        if (legend.style.display === 'block') {
          legend.style.display = 'none';
          toggleBtn.innerText = 'Show Legend & Definitions';
        } else {
          legend.style.display = 'block';
          toggleBtn.innerText = 'Hide Legend & Definitions';
        }
      }

      // Toggle Dark/Light theme
      function toggleTheme(checkbox) {
        if (checkbox.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
        } else {
          document.documentElement.removeAttribute('data-theme');
        }
      }

      // Open the How-To modal dialog
      function openHowTo() {
        const modal = document.getElementById('howToModal');
        if (modal.showModal) {
          modal.showModal();
        } else {
          modal.style.display = 'flex';
        }
      }

      // Close the How-To modal dialog
      function closeHowTo() {
        const modal = document.getElementById('howToModal');
        if (modal.close) {
          modal.close();
        } else {
          modal.style.display = 'none';
        }
      }

      // Close the Tutorial modal dialog
      function closeTutorial() {
        const modal = document.getElementById('tutorialModal');
        if (modal.close) {
          modal.close();
        } else {
          modal.style.display = 'none';
        }
      }

      // Submit the Review Checklist
      function submitAssessment() {
        const checkboxes = document.querySelectorAll('.review-checklist input[type="checkbox"]');
        let allChecked = true;
        checkboxes.forEach(cb => {
          if (!cb.checked) { allChecked = false; }
        });
        const resultElem = document.getElementById('assessmentResult');
        if (allChecked) {
          resultElem.innerText = 'Review Checklist Complete! Great job!';
          resultElem.style.color = 'green';
        } else {
          resultElem.innerText = 'Please complete all items in the review checklist.';
          resultElem.style.color = 'red';
        }
      }

      // Prepend emoji for each category header
      function initEmojis() {
        const categoryHeaders = document.querySelectorAll('td.category-header');
        categoryHeaders.forEach(cell => {
          const category = cell.getAttribute('data-category');
          const emoji = categoryEmojis[category] || '';
          if (!cell.innerHTML.includes(emoji)) {
            cell.innerHTML = emoji + ' ' + cell.innerHTML;
          }
        });
      }

      // Store original header text for each section header
      function initSectionHeaders() {
        const sectionHeaders = document.querySelectorAll('tr.section-header');
        sectionHeaders.forEach(row => {
          const cell = row.querySelector('td');
          cell.dataset.original = cell.innerText.trim();
        });
      }

      // Update section headers with section score and color
      function updateSectionScores() {
        const sectionHeaders = document.querySelectorAll('tr.section-header');
        sectionHeaders.forEach(headerRow => {
          const group = headerRow.getAttribute('data-group');
          const groupRows = document.querySelectorAll('tr[data-group="' + group + '"]:not(.section-header)');
          let sectionScore = 0;
          groupRows.forEach(row => {
            const catCell = row.querySelector('td.category-header');
            if (catCell) {
              const cat = catCell.getAttribute('data-category');
              sectionScore += parseInt(scoreData[cat]) || 0;
            }
          });
          const numberOfRows = groupRows.length;
          const maxForSection = numberOfRows * 4;
          let sectionLabel;
          if (sectionScore === 0) {
            sectionLabel = "Incomplete";
            headerRow.style.backgroundColor = "white";
          } else {
            const average = sectionScore / numberOfRows;
            const sectionRating = getSectionRating(average);
            sectionLabel = sectionRating.label;
            headerRow.style.backgroundColor = hexToRGBA(sectionRating.color, 0.3);
          }
          const headerCell = headerRow.querySelector('td');
          headerCell.innerHTML =
            '<strong>' + headerCell.dataset.original + '</strong> ' +
            '<span style="font-weight:normal;">(Score: ' + sectionScore + '/' + maxForSection + ' - ' + sectionLabel + ')</span>';
        });
      }

      // Random inspirational quote
      function randomQuote() {
        const quoteSection = document.getElementById('quoteSection');
        const randomIndex = Math.floor(Math.random() * editorQuotes.length);
        quoteSection.innerText = editorQuotes[randomIndex];
      }

      // Random fun fact
      function randomFunFact() {
        const funFacts = [
          "Did you know? The first film edit was done by physically cutting and splicing film.",
          "Fun Fact: Walter Murch, a legendary editor, also worked as a sound mixer!",
          "Tip: Sometimes less is more—trim your edits for a tighter story.",
          "Did you know? The famous 'montage' technique was popularized in Soviet cinema.",
          "Editing can change the story. A single cut can evoke deep emotions."
        ];
        const funFactSection = document.getElementById('funFactSection');
        const randomIndex = Math.floor(Math.random() * funFacts.length);
        funFactSection.innerText = funFacts[randomIndex];
      }

      // Disney Magic confetti
      function onClickDisneyMagic() {
        launchConfetti();
        alert("Disney Magic activated! ✨");
      }

      function launchConfetti() {
        if (typeof confetti === "function") {
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
          });
        }
      }

      // Editor quotes array
      const editorQuotes = [
        "“In film editing, it's not about what you add, it's about what you leave out.” – Walter Murch",
        "“Cutting is rewriting.” – Thelma Schoonmaker",
        "“Editing is where the magic happens.” – Unknown",
        "“Good editing is invisible; great editing is felt.” – Unknown",
        "“In editing, less is often more.” – Unknown",
        "“All our dreams can come true if we have the courage to pursue them.” – Walt Disney",
        "“It's kind of fun to do the impossible.” – Walt Disney",
        "“The past can hurt. But the way I see it, you can either run from it, or learn from it.” – Rafiki, The Lion King",
        "“Cinema is truth at 24 frames per second.” – Jean-Luc Godard",
        "“The secret to film editing is knowing when to cut.” – Unknown",
        "“Every cut tells a story.” – Unknown",
        "“Editing is the craft of transforming raw footage into art.” – Unknown",
        "“A good cut is a silent hero.” – Unknown",
        "“When you're editing, you're not just cutting footage; you're sculpting a story.” – Unknown",
        "“The technique of film editing is to be invisible.” – Walter Murch",
        "“The art of editing is the art of omission.” – Elia Kazan",
        "“I’m convinced that nothing happens in the editing room.” – Francis Ford Coppola",
        "“May your edits be as magical as pixie dust.” – Inspired by Disney",
        "“If you can dream it, you can do it.” – Walt Disney"
      ];
    </script>
  </body>
</html>
