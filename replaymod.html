<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Replay mod</title>

    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      integrity="sha512-Fo3rlrZj/k7ujTnH/PRRZ9i6Lkxy/lK+Ad+Qw3PweIIsXgTn5N2sA3ZgP6L6YKn42pPZLNSQNkI3b7HlFj5pAg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Roboto Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- html2canvas for PNG Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Canvas Confetti for Outstanding Score Effect -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>

    <style>
      /* CSS Variables & Base Styles */
      :root {
        --primary-light: #4facfe;
        --accent-light: #00f2fe;
        --bg-light: #f9fafb;
        --text-light: #1e293b;
        --panel-light: rgba(255, 255, 255, 0.96);
        --border-light: rgba(255, 255, 255, 0.2);
        --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        --transition: all 0.2s ease;
        --radius: 14px;
        --gradient-light: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-light) 100%);
        --spacing: 1rem;
        --font-base: 'Roboto', sans-serif;
        --table-cell-bg-light: rgba(255, 255, 255, 0.85);
      }

      /* Dark Mode Variables */
      html[data-theme="dark"] {
        --bg-light: #1f1f1f;
        --text-light: #f3f3f3;
        --panel-light: rgba(18, 18, 18, 0.98);
        --border-light: rgba(255, 255, 255, 0.2);
        --gradient-light: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --table-cell-bg-light: rgba(30, 30, 30, 0.85);
      }

      /* Reduce motion class disables animations & transitions */
      body.reduce-motion *,
      body.reduce-motion *::before,
      body.reduce-motion *::after {
        animation: none !important;
        transition: none !important;
      }

      /* Base styles */
      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-base);
        background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px), var(--bg-light);
        background-size: 30px 30px;
        color: var(--text-light);
        transition: var(--transition);
      }

      button:focus,
      [tabindex]:focus {
        outline: 2px solid var(--accent-light);
      }

      /* Panels */
      .glass-panel {
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        backdrop-filter: blur(12px);
        padding: var(--spacing);
        margin-bottom: var(--spacing);
      }

      /* HEADER */
      header.analyzer-header {
        position: sticky;
        top: 0;
        z-index: 2000;
        padding: 1.5rem 2rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .header-left {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
      }
      /* Site Title with Camera Icon */
      .site-title {
        font-size: 1.8rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .site-title i {
        color: var(--accent-light);
      }
      .total-score {
        font-size: 1.75rem;
        font-weight: 700;
        background: var(--gradient-light);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        position: relative;
        cursor: default;
        transition: var(--transition);
      }
      .total-score:hover::after {
        content: "Overall: (Score Sum out of 24)";
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 0.5rem;
        border-radius: 4px;
        top: 110%;
        left: 0;
        white-space: pre-line;
        font-size: 0.85rem;
        z-index: 1000;
      }
      .status-indicator {
        font-weight: 600;
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .header-right .group {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      /* Reduce Motion Toggle */
      .reduce-motion-toggle {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        font-size: 0.9rem;
      }

      .btn {
        background: var(--gradient-light);
        color: #fff;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 6px rgba(126, 34, 206, 0.2);
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(126, 34, 206, 0.4);
      }

      /* Dark Mode Slider */
      .dark-mode { }
      .toggle-label.dark-mode-label {
        cursor: pointer;
        display: inline-flex;
        align-items: center;
      }
      .dark-mode-slider {
        position: relative;
        width: 60px;
        height: 30px;
        background-color: #e0e0e0;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 5px;
        transition: background-color 0.3s;
      }
      .dark-mode-slider .mode-label {
        font-size: 16px;
      }
      .dark-mode-slider .slider-thumb {
        position: absolute;
        width: 26px;
        height: 26px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.3s;
      }
      input#darkModeToggle { display: none; }
      input#darkModeToggle:checked + .dark-mode-slider .slider-thumb {
        transform: translateX(30px);
      }
      input#darkModeToggle:checked + .dark-mode-slider {
        background-color: var(--primary-light);
      }

      /* Quote Section (Top) */
      .quote-section {
        text-align: center;
        margin: 1rem auto;
        font-style: italic;
        padding: 0.5rem;
        background: var(--panel-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        animation: fadeIn 0.8s ease-in-out;
        max-width: 800px;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Main Content */
      main {
        margin: var(--spacing) auto;
      }
      .analyzer-container {
        width: 95%;
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 var(--spacing) 2rem;
      }

      /* Rubric Table */
      .rubric-table {
        margin-bottom: var(--spacing);
        overflow-x: auto;
      }
      .modern-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-family: var(--font-base);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: var(--radius);
        overflow: hidden;
        transition: var(--transition);
      }
      .modern-table thead th {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        position: sticky;
        top: 0;
        backdrop-filter: blur(10px);
        z-index: 10;
      }
      .modern-table thead th:first-child {
        background: var(--gradient-light);
        color: #fff;
      }
      /* Re-apply original colors for rating columns */
      .modern-table thead th:nth-child(2) { background: #f87171; }
      .modern-table thead th:nth-child(3) { background: #fb923c; }
      .modern-table thead th:nth-child(4) { background: #facc15; }
      .modern-table thead th:nth-child(5) { background: #4ade80; }
      .modern-table tbody td {
        padding: 0.75rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        vertical-align: middle;
        min-width: 150px;
        cursor: pointer;
        background: var(--table-cell-bg-light);
      }
      .modern-table tbody td:hover {
        transform: scale(1.02);
        background-color: rgba(224, 231, 255, 0.3);
      }
      .modern-table tbody tr:hover td {
        background-color: rgba(0, 0, 0, 0.03);
      }
      .modern-table td.selected {
        background: rgba(224, 231, 255, 0.5) !important;
        box-shadow: inset 4px 0 0 var(--primary-light);
      }
      .category-header {
        font-weight: bold;
      }

      /* Feedback Panel */
      .feedback-panel h3 { margin-top: 0; }
      .feedback-panel .feedback-entry { margin-bottom: var(--spacing); }
      .feedback-panel label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.3rem;
      }
      .feedback-input {
        display: block;
        width: 100%;
        max-width: 600px;
        box-sizing: border-box;
        min-height: 80px;
        padding: var(--spacing);
        border: 2px solid #e2e8f0;
        border-radius: var(--radius);
        font-size: 1rem;
        transition: var(--transition);
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow: auto;
      }
      .feedback-input:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.2);
      }
      .feedback-input:empty::before {
        content: attr(data-placeholder);
        color: #9ca3af;
      }

      /* Legend & Definitions */
      #toggleLegend {
        margin: var(--spacing) 0;
        padding: 0.4rem 0.8rem;
        background: var(--gradient-light);
        color: #fff;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        transition: var(--transition);
      }
      #toggleLegend:hover { opacity: 0.9; }
      #legend {
        display: none;
        margin-top: 0.5rem;
        font-size: 0.9rem;
        line-height: 1.4;
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        padding: var(--spacing);
      }
      #legend h4 { margin-top: 0; }

      /* Self-Assessment Checklist Section */
      .self-assessment-section {
        background: var(--panel-light);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: var(--spacing);
        margin: 1rem auto;
        max-width: 800px;
      }
      .self-assessment-section h3 {
        text-align: center;
        margin-top: 0;
      }
      .self-assessment-section ul {
        list-style: none;
        padding-left: 0;
      }
      .self-assessment-section li {
        margin: 0.5rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .self-assessment-section input[type="checkbox"] {
        transform: scale(1.2);
        cursor: pointer;
      }
      .assessment-result {
        text-align: center;
        font-weight: bold;
        margin-top: var(--spacing);
      }

      /* Fun Fact Section (Bottom) */
      .fun-fact-section {
        text-align: center;
        margin: 1rem auto;
        font-style: italic;
        padding: 0.5rem;
        background: var(--panel-light);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        animation: fadeIn 0.8s ease-in-out;
        max-width: 800px;
      }

      /* Cinematic Magic Easter Egg Icon */
      #cinematicMagic {
        position: fixed;
        bottom: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 2em;
        z-index: 10000;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
      }

      /* Modal Styles */
      .modal-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: var(--spacing);
      }
      .modal-bg.show {
        display: flex;
        animation: fadeIn 0.3s ease-in-out;
      }
      .modal-content {
        position: relative;
        background: #fff;
        border-radius: var(--radius);
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
        padding: 1.5rem;
      }
      .close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        cursor: pointer;
      }
      .close-btn:hover {
        background: rgba(255, 255, 255, 1);
      }

      /* Responsive */
      @media (max-width: 992px) {
        .analyzer-container { padding: 0 1rem 2rem; }
      }
    </style>
  </head>
  <body>
    <!-- HEADER -->
    <header class="analyzer-header glass-panel">
      <div class="header-left">
        <div class="site-title">
          <i class="fas fa-camera" aria-hidden="true"></i>
          <span>Replay mod</span>
        </div>
        <div class="total-score" id="scoreDisplay" tabindex="0">
          Overall: <span id="overallTotal">0</span>/24 ‚Äì <span id="scoreLabel">Needs Work</span>
        </div>
        <div class="status-indicator" id="ranking" aria-live="polite">Incomplete</div>
      </div>
      <div class="header-right">
        <div class="group">
          <button class="btn" onclick="resetScores()" aria-label="Reset Scores">üîÑ Reset</button>
          <button class="btn" onclick="exportPNG()" aria-label="Export as PNG">üñºÔ∏è Export PNG</button>
          <button class="btn" onclick="openHowTo()" aria-label="How To Use">‚ùì How To</button>
        </div>
        <!-- Dark Mode Toggle -->
        <div class="dark-mode">
          <label class="toggle-label dark-mode-label" for="darkModeToggle">
            <input type="checkbox" id="darkModeToggle" onchange="toggleTheme(this)" aria-label="Toggle Dark Mode" />
            <div class="dark-mode-slider">
              <span class="mode-label mode-light">‚òÄÔ∏è</span>
              <span class="mode-label mode-dark">üåô</span>
              <div class="slider-thumb"></div>
            </div>
          </label>
        </div>
        <!-- Reduce Motion Toggle -->
        <div class="reduce-motion-toggle">
          <label for="reduceMotionToggle">Reduce Motion</label>
          <input type="checkbox" id="reduceMotionToggle" onchange="toggleAnimations(this)" aria-label="Toggle Reduce Motion" />
        </div>
      </div>
    </header>

    <!-- QUOTE OF WISDOM SECTION (Top) -->
    <div class="quote-section glass-panel" id="quoteSection" role="note" aria-live="polite">
      <!-- A random inspirational replay mod quote will appear here -->
    </div>

    <main>
      <div class="analyzer-container">
        <!-- REPLAY SHOT RUBRIC SECTION -->
        <section class="rubric-table glass-panel" aria-labelledby="replayRubricHeading">
          <h2 id="replayRubricHeading">Replay Shot Review Rubric</h2>
          <table class="modern-table" id="replayTable">
            <thead>
              <tr>
                <th scope="col">Category</th>
                <th scope="col">Needs Improvement (1)</th>
                <th scope="col">Good (2)</th>
                <th scope="col">Excellent (3)</th>
                <th scope="col">Outstanding (4)</th>
              </tr>
            </thead>
            <tbody>
              <!-- Most important: Composition & Framing -->
              <tr>
                <td class="category-header" data-category="0"><strong>Composition &amp; Framing</strong></td>
                <td data-category="0" data-rating="1" role="button" tabindex="0">
                  Poorly arranged elements with no clear focus.
                </td>
                <td data-category="0" data-rating="2" role="button" tabindex="0">
                  Basic framing following standard rules but lacking creativity.
                </td>
                <td data-category="0" data-rating="3" role="button" tabindex="0">
                  Well-balanced composition with clear focal points.
                </td>
                <td data-category="0" data-rating="4" role="button" tabindex="0">
                  Exceptionally arranged elements with artistic framing.
                </td>
              </tr>
              <!-- Second priority: Camera Movement & Stability -->
              <tr>
                <td class="category-header" data-category="1"><strong>Camera Movement &amp; Stability</strong></td>
                <td data-category="1" data-rating="1" role="button" tabindex="0">
                  Erratic or unstable movement detracting from the shot.
                </td>
                <td data-category="1" data-rating="2" role="button" tabindex="0">
                  Movement is present but lacks smoothness or intent.
                </td>
                <td data-category="1" data-rating="3" role="button" tabindex="0">
                  Smooth, deliberate motion that enhances the visual.
                </td>
                <td data-category="1" data-rating="4" role="button" tabindex="0">
                  Exceptionally fluid movement that adds dynamic quality.
                </td>
              </tr>
              <!-- Third priority: Lighting, Color & Atmosphere -->
              <tr>
                <td class="category-header" data-category="2"><strong>Lighting, Color &amp; Atmosphere</strong></td>
                <td data-category="2" data-rating="1" role="button" tabindex="0">
                  Inadequate lighting and poor color balance resulting in a flat look.
                </td>
                <td data-category="2" data-rating="2" role="button" tabindex="0">
                  Acceptable lighting with only a basic mood established.
                </td>
                <td data-category="2" data-rating="3" role="button" tabindex="0">
                  Well-lit scene with appropriate color grading enhancing the mood.
                </td>
                <td data-category="2" data-rating="4" role="button" tabindex="0">
                  Outstanding lighting and color that create an immersive atmosphere.
                </td>
              </tr>
              <!-- Fourth priority: Technical Quality & Clarity -->
              <tr>
                <td class="category-header" data-category="3"><strong>Technical Quality &amp; Clarity</strong></td>
                <td data-category="3" data-rating="1" role="button" tabindex="0">
                  Visible technical issues (low resolution, glitches, or blurriness).
                </td>
                <td data-category="3" data-rating="2" role="button" tabindex="0">
                  Adequate quality with minor flaws affecting clarity.
                </td>
                <td data-category="3" data-rating="3" role="button" tabindex="0">
                  Clear, stable visuals with high-quality technical execution.
                </td>
                <td data-category="3" data-rating="4" role="button" tabindex="0">
                  Pristine resolution and stability with flawless technical quality.
                </td>
              </tr>
              <!-- Fifth priority: Creative Angles & Perspectives -->
              <tr>
                <td class="category-header" data-category="4"><strong>Creative Angles &amp; Perspectives</strong></td>
                <td data-category="4" data-rating="1" role="button" tabindex="0">
                  Conventional or uninspired angles with minimal variation.
                </td>
                <td data-category="4" data-rating="2" role="button" tabindex="0">
                  Some creative angles attempted, though not consistently effective.
                </td>
                <td data-category="4" data-rating="3" role="button" tabindex="0">
                  Well-chosen angles offering fresh perspectives.
                </td>
                <td data-category="4" data-rating="4" role="button" tabindex="0">
                  Innovative angles that significantly enhance the shot.
                </td>
              </tr>
              <!-- Last: Overall Cinematic Impact -->
              <tr>
                <td class="category-header" data-category="5"><strong>Overall Cinematic Impact</strong></td>
                <td data-category="5" data-rating="1" role="button" tabindex="0">
                  Fails to leave a memorable impression.
                </td>
                <td data-category="5" data-rating="2" role="button" tabindex="0">
                  Some impact, but overall unremarkable.
                </td>
                <td data-category="5" data-rating="3" role="button" tabindex="0">
                  Engaging and leaves a positive impression.
                </td>
                <td data-category="5" data-rating="4" role="button" tabindex="0">
                  Exceptionally impressive, evoking strong emotion.
                </td>
              </tr>
            </tbody>
          </table>
          <button id="toggleLegend" onclick="toggleLegend()">Show Legend &amp; Definitions</button>
          <div id="legend">
            <h4>Legend &amp; Definitions</h4>
            <p><strong>Needs Improvement (1):</strong> Significant shortcomings in this category.</p>
            <p><strong>Good (2):</strong> Meets basic standards but room for improvement.</p>
            <p><strong>Excellent (3):</strong> High-quality execution with only minor refinements needed.</p>
            <p><strong>Outstanding (4):</strong> Exceeds standards with exceptional execution.</p>
          </div>
        </section>

        <!-- FEEDBACK PANEL -->
        <section class="feedback-panel glass-panel" aria-labelledby="feedbackHeading">
          <h3 id="feedbackHeading">Reviewer Feedback</h3>
          <div class="feedback-entry">
            <label for="humanFeedback">Reviewer Comments</label>
            <div id="humanFeedback" class="feedback-input" contenteditable="true" data-placeholder="Enter your reviewer feedback here..." aria-label="Reviewer Feedback"></div>
          </div>
          <div class="feedback-entry">
            <label for="aiFeedback">AI Feedback</label>
            <div id="aiFeedback" class="feedback-input" contenteditable="true" data-placeholder="Enter your AI feedback here..." aria-label="AI Feedback"></div>
          </div>
        </section>
      </div>

      <!-- SELF-ASSESSMENT CHECKLIST SECTION -->
      <section class="self-assessment-section" aria-labelledby="selfAssessmentHeading">
        <h3 id="selfAssessmentHeading">Self-Assessment Checklist</h3>
        <ul>
          <li><input type="checkbox" id="check1"> <label for="check1">Is the composition well‚Äëexecuted?</label></li>
          <li><input type="checkbox" id="check2"> <label for="check2">Is the camera movement smooth and stable?</label></li>
          <li><input type="checkbox" id="check3"> <label for="check3">Does the lighting and color set the appropriate mood?</label></li>
          <li><input type="checkbox" id="check4"> <label for="check4">Is the technical quality (resolution, clarity) high?</label></li>
          <li><input type="checkbox" id="check5"> <label for="check5">Are creative angles effectively used?</label></li>
          <li><input type="checkbox" id="check6"> <label for="check6">Does the shot leave a strong overall impact?</label></li>
        </ul>
        <button class="btn" onclick="submitAssessment()">Submit Self-Assessment</button>
        <div class="assessment-result" id="assessmentResult" aria-live="polite"></div>
      </section>

      <!-- FUN FACT SECTION (Bottom) -->
      <div class="fun-fact-section glass-panel" id="funFactSection" role="note" aria-live="polite">
        <!-- A random fun replay mod fact or tip will appear here -->
      </div>
    </main>

    <!-- HOW-TO MODAL -->
    <dialog class="modal-bg" id="howToModal" aria-labelledby="howToHeading" aria-modal="true">
      <div class="modal-content">
        <button class="close-btn" onclick="closeHowTo()" aria-label="Close How To">&times;</button>
        <h2 id="howToHeading">How to Use Replay mod</h2>
        <ul>
          <li>Click on each rating cell to score the replay shot.</li>
          <li>The Overall Score (out of 24) updates live as you select ratings.</li>
          <li>Focus on objective criteria such as composition, movement, lighting, technical quality, and creativity.</li>
          <li>Provide additional comments in the Reviewer and AI feedback boxes.</li>
          <li>Use the Self-Assessment Checklist to reflect on your shot‚Äôs quality.</li>
          <li>When finished, reset scores or export the review as a PNG.</li>
        </ul>
      </div>
    </dialog>

    <!-- TUTORIAL MODAL -->
    <dialog class="modal-bg" id="tutorialModal" aria-labelledby="tutorialHeading" aria-modal="true">
      <div class="modal-content">
        <button class="close-btn" onclick="closeTutorial()" aria-label="Close Tutorial">&times;</button>
        <div id="tutorialContent"></div>
      </div>
    </dialog>

    <!-- Hidden Audio Elements for Sound Effects -->
    <audio id="victorySound" src="victory.mp3"></audio>
    <audio id="wompSound" src="womp.mp3"></audio>

    <!-- CINEMATIC MAGIC EASTER EGG ICON -->
    <div id="cinematicMagic" title="Click for a dose of cinematic magic!">‚ú®</div>

    <script>
      /***************************************************
       * Global Variables & Setup
       ***************************************************/
      let shotScores = {};
      let confettiShown = false;
      const progressAudio = {
        victory: document.getElementById("victorySound"),
        womp: document.getElementById("wompSound")
      };

      // Array of inspirational replay mod quotes
      const cineQuotes = [
        "‚ÄúCinematography is the art of painting with light.‚Äù ‚Äì Unknown",
        "‚ÄúA great shot is like a painting in motion.‚Äù ‚Äì Unknown",
        "‚ÄúEvery frame tells a story.‚Äù ‚Äì Unknown",
        "‚ÄúMagic happens when the camera starts moving.‚Äù ‚Äì Unknown",
        "‚ÄúCapture the moment and create the magic.‚Äù ‚Äì Unknown"
      ];

      // Array of fun facts and tips
      const funFacts = [
        "Fun Fact: Some of Minecraft‚Äôs most epic moments are captured with Replay mod!",
        "Tip: Smooth camera movement transforms a basic shot into a cinematic scene.",
        "Did you know? Lighting is key to setting the perfect mood in your replay.",
        "Experiment with angles ‚Äì sometimes a slight change makes a big difference.",
        "Always check your technical quality: a stable, high‚Äëres shot speaks volumes."
      ];

      /***************************************************
       * DOMContentLoaded Setup
       ***************************************************/
      document.addEventListener("DOMContentLoaded", () => {
        // Set a random quote
        const lastQuote = localStorage.getItem("lastQuoteIndex");
        let newQuoteIndex;
        do {
          newQuoteIndex = Math.floor(Math.random() * cineQuotes.length);
        } while (cineQuotes.length > 1 && newQuoteIndex == lastQuote);
        localStorage.setItem("lastQuoteIndex", newQuoteIndex);
        document.getElementById("quoteSection").innerText = cineQuotes[newQuoteIndex];

        // Set a random fun fact
        document.getElementById("funFactSection").innerText = funFacts[Math.floor(Math.random() * funFacts.length)];

        // Event delegation for the Replay rubric table
        document.getElementById("replayTable").addEventListener("click", function(e) {
          const cell = e.target.closest('td[data-rating]');
          if (cell) selectRating(cell);
        });

        // Add click event for the Cinematic Magic icon
        document.getElementById("cinematicMagic").addEventListener("click", triggerCinematicMagic);
      });

      /***************************************************
       * Rubric Functions
       ***************************************************/
      function selectRating(cell) {
        const categoryIndex = Number(cell.getAttribute('data-category'));
        const rating = parseInt(cell.getAttribute('data-rating'));
        const row = cell.parentElement;
        row.querySelectorAll('td').forEach(td => {
          if (td !== row.firstElementChild) td.classList.remove('selected');
        });
        cell.classList.add('selected');
        shotScores[categoryIndex] = rating;
        updateTotals();
      }

      function updateTotals() {
        let overallTotal = Object.values(shotScores).reduce((a, b) => a + b, 0);
        document.getElementById('overallTotal').textContent = overallTotal;
        let scoreLabel = document.getElementById('scoreLabel');
        let ranking = document.getElementById('ranking');
        // Ensure all 6 categories are rated
        if (Object.keys(shotScores).length < 6) {
          ranking.textContent = "Incomplete";
          ranking.style.color = "#64748b";
        } else if (overallTotal < 10) {
          scoreLabel.textContent = "Needs Work";
          ranking.textContent = "Needs Work üî¥";
          ranking.style.color = "#ef4444";
          progressAudio.womp.play && progressAudio.womp.play();
        } else if (overallTotal < 16) {
          scoreLabel.textContent = "Good";
          ranking.textContent = "Good üëç";
          ranking.style.color = "#22c55e";
        } else if (overallTotal < 22) {
          scoreLabel.textContent = "Excellent";
          ranking.textContent = "Excellent üü°";
          ranking.style.color = "#eab308";
        } else {
          scoreLabel.textContent = "Outstanding";
          ranking.textContent = "Outstanding üîµ";
          ranking.style.color = "#3b82f6";
          progressAudio.victory.play && progressAudio.victory.play();
          if (!confettiShown) {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            confettiShown = true;
          }
        }
      }

      /***************************************************
       * Reset Function
       ***************************************************/
      function resetScores() {
        shotScores = {};
        document.querySelectorAll('#replayTable td[data-rating]').forEach(cell => cell.classList.remove('selected'));
        document.getElementById('overallTotal').textContent = '0';
        document.getElementById('scoreLabel').textContent = 'Needs Work';
        document.getElementById('ranking').textContent = 'Incomplete';
        confettiShown = false;
      }

      /***************************************************
       * Export Function (PNG)
       ***************************************************/
      async function exportPNG() {
        const header = document.querySelector("header.analyzer-header");
        const originalPosition = header.style.position;
        header.style.position = "static";
        const canvas = await html2canvas(document.body, { scale: 2, useCORS: true });
        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = 'replay-mod-review.png';
        link.href = dataUrl;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        header.style.position = originalPosition;
      }

      /***************************************************
       * Theme & Animation Toggle Functions
       ***************************************************/
      function toggleTheme(input) {
        const html = document.documentElement;
        if (input.checked) {
          html.setAttribute("data-theme", "dark");
        } else {
          html.removeAttribute("data-theme");
        }
      }
      function toggleAnimations(input) {
        if (input.checked) {
          document.body.classList.add("reduce-motion");
        } else {
          document.body.classList.remove("reduce-motion");
        }
      }

      /***************************************************
       * Modal Functions ‚Äì Using <dialog> for accessibility
       ***************************************************/
      function openHowTo() {
        const dialog = document.getElementById("howToModal");
        dialog.showModal();
        dialog.querySelector(".close-btn").focus();
      }
      function closeHowTo() {
        document.getElementById("howToModal").close();
      }
      function openTutorial(topic) {
        const tutorialContent = document.getElementById('tutorialContent');
        let content = "";
        if (topic === 'composition') {
          content = "<h2>Enhancing Composition</h2><p>Arrange elements purposefully using rules like the rule of thirds to create a balanced frame.</p>";
        } else if (topic === 'movement') {
          content = "<h2>Smooth Camera Movement</h2><p>Ensure your camera movements are stable and intentional to enhance the shot‚Äôs visual flow.</p>";
        } else if (topic === 'lighting') {
          content = "<h2>Effective Lighting</h2><p>Proper lighting and color grading set the mood and clarity of the shot.</p>";
        } else {
          content = "<h2>Tutorial</h2><p>No tutorial available for this topic.</p>";
        }
        tutorialContent.innerHTML = content;
        const dialog = document.getElementById("tutorialModal");
        dialog.showModal();
        dialog.querySelector(".close-btn").focus();
      }
      function closeTutorial() {
        document.getElementById("tutorialModal").close();
      }
      function toggleLegend() {
        const legend = document.getElementById("legend");
        const btn = document.getElementById("toggleLegend");
        if (legend.style.display === "none" || legend.style.display === "") {
          legend.style.display = "block";
          btn.textContent = "Hide Legend & Definitions";
        } else {
          legend.style.display = "none";
          btn.textContent = "Show Legend & Definitions";
        }
      }

      /***************************************************
       * Self-Assessment Checklist Functions
       ***************************************************/
      function submitAssessment() {
        const checklist = document.querySelectorAll('.self-assessment-section input[type="checkbox"]');
        let checkedCount = 0;
        checklist.forEach(box => {
          if (box.checked) checkedCount++;
        });
        const totalItems = checklist.length;
        let resultText = `You checked ${checkedCount} out of ${totalItems} items. `;
        if (checkedCount === totalItems) {
          resultText += "üéâ Master Replay Mod Reviewer: Excellent work!";
          confetti({ particleCount: 200, spread: 100, origin: { y: 0.5 } });
        } else if (checkedCount >= totalItems * 0.75) {
          resultText += "Great job! You're nearly there.";
        } else {
          resultText += "Keep refining your shot for that cinematic masterpiece.";
        }
        document.getElementById("assessmentResult").innerText = resultText;
      }

      /***************************************************
       * Cinematic Magic Easter Egg Function
       ***************************************************/
      function triggerCinematicMagic() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        const cinematicQuotes = [
          "‚ÄúEvery frame is a canvas.‚Äù ‚Äì Unknown",
          "‚ÄúMagic happens when the camera moves.‚Äù ‚Äì Unknown",
          "‚ÄúLet your shot tell the story.‚Äù ‚Äì Unknown",
          "‚ÄúA pause can speak louder than motion.‚Äù ‚Äì Unknown",
          "‚ÄúCapture the moment, create the magic.‚Äù ‚Äì Unknown"
        ];
        const randomIndex = Math.floor(Math.random() * cinematicQuotes.length);
        alert(cinematicQuotes[randomIndex]);
      }

      /***************************************************
       * Easter Egg Shortcut (Alt+E)
       ***************************************************/
      document.addEventListener("keydown", function(e) {
        if (e.altKey && e.key.toLowerCase() === "e") {
          triggerCinematicMagic();
        }
      });
    </script>
  </body>
</html>
