<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thumbnail Analyzer Pro+ (Upgraded)</title>
  
  <!-- Optional: Color Thief for palette extraction -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>

  <!-- PDF export libraries -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <style>
    /* 
      DARK/LIGHT THEME VARIABLES
      We define two sets of colors, for light and dark modes. The actual toggle 
      is done by adding/removing data-theme="dark" on the <html> tag. 
    */
    :root {
      --primary-light: #6366f1;
      --secondary-light: #4f46e5;
      --accent-light: #ec4899;
      --bg-light: #f8fafc;
      --text-light: #1e293b;
      --panel-light: rgba(255, 255, 255, 0.98);
      --border-light: rgba(255, 255, 255, 0.2);

      --primary-dark: #818cf8;
      --secondary-dark: #4f46e5;
      --accent-dark: #ec4899;
      --bg-dark: #1f1f1f;
      --text-dark: #f3f3f3;
      --panel-dark: rgba(18, 18, 18, 0.98);
      --border-dark: rgba(255, 255, 255, 0.2);

      --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
      --transition: all 0.3s ease;
      --radius: 12px;
      --gradient-light: linear-gradient(135deg, var(--primary-light) 0%, var(--accent-light) 100%);
      --gradient-dark: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent-dark) 100%);
    }

    /* Default (light) theme values */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: var(--transition);
    }

    .analyzer-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .glass-panel {
      background: var(--panel-light);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      transition: var(--transition);
    }

    /* Dark theme override (when html[data-theme="dark"]) */
    html[data-theme="dark"] {
      --bg-light: var(--bg-dark);
      --text-light: var(--text-dark);
      --panel-light: var(--panel-dark);
      --border-light: var(--border-dark);
      --gradient-light: var(--gradient-dark);
      --primary-light: var(--primary-dark);
      --accent-light: var(--accent-dark);
    }

    /* ========== Header & Sticky Score ========== */
    .analyzer-header {
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .header-content {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: center;
      justify-content: space-between;
    }
    .score-display {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .total-score {
      font-size: 1.75rem;
      font-weight: 700;
      background: var(--gradient-light);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: var(--transition);
    }
    .status-indicator {
      font-weight: 600;
    }
    .controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .btn {
      background: var(--gradient-light);
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px rgba(99, 102, 241, 0.15);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
      opacity: 0.9;
    }

    /* ========== Title & Thumbnails Preview ========== */
    .preview-section {
      padding: 2rem;
      margin-bottom: 2rem;
      position: relative;
    }
    .title-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: var(--radius);
      font-size: 1rem;
      transition: var(--transition);
      margin-bottom: 1rem;
    }
    .title-input:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }
    .title-preview {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: var(--radius);
      background: rgba(99, 102, 241, 0.05);
      transition: var(--transition);
    }

    /* Actual-size YouTube previews 
       - Approx. sizes (16:9 aspect ratio)
         Home feed: ~210 x 118
         Suggested: ~168 x 94
         Mobile:   ~320 x 180 or smaller on some screens
    */
    .previews-container {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: flex-start;
      margin-top: 2rem;
    }
    .preview-box {
      display: inline-block;
      text-align: left;
    }
    .preview-label {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .thumbnail-wrap {
      position: relative;
      background: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px dashed rgba(99, 102, 241, 0.2);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .youtube-thumb {
      display: block;
      object-fit: cover;
    }

    /* Simulating YouTube Title under thumbnail:
       - Typically about 2 lines or truncated. We'll approximate style. */
    .youtube-title {
      font-size: 14px;
      color: #111;
      margin-top: 0.5rem;
      max-width: 210px; /* match or approximate thumbnail width */
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      white-space: normal;
    }

    /* ========== Upload Button ========== */
    .upload-container {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
    }
    .hidden-input {
      display: none;
    }

    /* ========== Rubric Table ========== */
    .rubric-table {
      margin: 2rem 0;
      overflow-x: auto;
    }
    .modern-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 800px;
    }
    .modern-table th {
      background: var(--gradient-light);
      color: white;
      padding: 1.25rem;
      font-weight: 600;
      position: sticky;
      top: 0;
      backdrop-filter: blur(10px);
      z-index: 10;
    }
    .modern-table td {
      padding: 1.25rem;
      border-bottom: 1px solid rgba(224, 231, 255, 0.3);
      transition: var(--transition);
      vertical-align: top;
      min-width: 160px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.85);
    }
    .category-header {
      font-weight: 600;
      background: rgba(99, 102, 241, 0.08);
      position: sticky;
      left: 0;
      min-width: 180px;
      backdrop-filter: blur(5px);
      border-right: 1px solid rgba(224, 231, 255, 0.3);
      z-index: 9;
    }
    .modern-table td:not(.category-header):hover {
      background: rgba(224, 231, 255, 0.3);
      transform: scale(1.02);
    }
    .selected {
      background: rgba(224, 231, 255, 0.5) !important;
      box-shadow: inset 4px 0 0 var(--primary-light);
      transform: scale(1.02);
    }

    /* ========== Feedback Panels ========== */
    .feedback-panel, .resources, .auto-insights {
      padding: 2rem;
      margin: 2rem 0;
    }
    .feedback-item {
      margin: 0.5rem 0; 
      padding: 1rem; 
      border-radius: var(--radius);
      background: rgba(99, 102, 241, 0.05);
    }
    .ai-suggestions {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: var(--radius);
      background: rgba(236, 72, 153, 0.05);
    }
    .keyword {
      background: rgba(236, 72, 153, 0.1);
      padding: 2px 4px;
      border-radius: 4px;
    }

    /* ========== Automatic Insights (Color Palette, etc.) ========== */
    .palette-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .color-swatch {
      width: 40px;
      height: 40px;
      border-radius: var(--radius);
      border: 1px solid #ccc;
    }
    .insight-message {
      margin-top: 1rem;
    }

    /* ========== Loading Spinner ========== */
    .loading-spinner {
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .youtube-title {
        max-width: 100%;
      }
      .preview-section {
        padding: 1rem;
      }
      .controls {
        justify-content: center;
      }
      .previews-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="analyzer-container">
    <!-- ========== HEADER/STICKY SCORE ========== -->
    <div class="analyzer-header glass-panel">
      <div class="header-content">
        <div class="score-display">
          <div class="total-score">Score: <span id="total">0</span>/40</div>
          <div class="status-indicator" id="ranking">Incomplete</div>
        </div>
        <div class="controls">
          <button class="btn" onclick="toggleTheme()">🌓 Theme</button>
          <button class="btn" onclick="resetScores()">🔄 Reset Scores</button>
          <button class="btn" onclick="exportPDF()">📥 Export Report</button>
          <button class="btn" onclick="getAISuggestions()">🤖 AI Suggestions</button>
        </div>
      </div>
    </div>
    
    <!-- ========== PREVIEW SECTION ========== -->
    <div class="preview-section glass-panel">
      <h2>Video Title &amp; Thumbnail Preview</h2>
      <input
        type="text"
        id="videoTitle"
        class="title-input"
        placeholder="Enter video title here..."
      />
      <div id="titlePreview" class="title-preview"></div>
      
      <div class="upload-container">
        <button class="btn" onclick="document.getElementById('thumbnailUpload').click()">📁 Upload Image</button>
        <input type="file" id="thumbnailUpload" accept="image/*" class="hidden-input" />
      </div>
      
      <!-- Actual-size YouTube Previews -->
      <div class="previews-container">
        <!-- HOME PAGE SIZE (Approx. 210 x 118) -->
        <div class="preview-box">
          <div class="preview-label">YouTube Home</div>
          <div class="thumbnail-wrap" style="width:210px; height:118px;">
            <img
              id="homePreview"
              class="youtube-thumb"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
              alt=""
              width="210" 
              height="118" 
            />
          </div>
          <div id="homeTitle" class="youtube-title"></div>
        </div>

        <!-- SUGGESTED SIZE (Approx. 168 x 94) -->
        <div class="preview-box">
          <div class="preview-label">Suggested Video</div>
          <div class="thumbnail-wrap" style="width:168px; height:94px;">
            <img
              id="suggestedPreview"
              class="youtube-thumb"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
              alt=""
              width="168" 
              height="94" 
            />
          </div>
          <div id="suggestedTitle" class="youtube-title" style="max-width:168px;"></div>
        </div>

        <!-- MOBILE SIZE (Approx. 320 x 180) -->
        <div class="preview-box">
          <div class="preview-label">Mobile View</div>
          <div class="thumbnail-wrap" style="width:320px; height:180px;">
            <img
              id="mobilePreview"
              class="youtube-thumb"
              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="
              alt=""
              width="320" 
              height="180" 
            />
          </div>
          <div id="mobileTitle" class="youtube-title" style="max-width:320px;"></div>
        </div>
      </div>
    </div>

    <!-- ========== RUBRIC TABLE ========== -->
    <div class="rubric-table glass-panel">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Category</th>
            <th>Basic (1)</th>
            <th>Good (2)</th>
            <th>Great (3)</th>
            <th>Excellent (4)</th>
          </tr>
        </thead>
        <tbody>
          <!-- Scroll-Stopping Power -->
          <tr>
            <td class="category-header" data-category="0">Scroll-Stopping Power</td>
            <td data-category="0" data-rating="1">Basic colors/text. Blends into feed.</td>
            <td data-category="0" data-rating="2">Bright colors OR faces OR danger/movement.</td>
            <td data-category="0" data-rating="3">Combines 2+ “scroll-stoppers” (e.g. money + shoes).</td>
            <td data-category="0" data-rating="4">Triggers “MUST CLICK” urgency (e.g a mystery box + danger).</td>
          </tr>
          <!-- Composition & Design -->
          <tr>
            <td class="category-header" data-category="1">Composition &amp; Design</td>
            <td data-category="1" data-rating="1">Functional layout.</td>
            <td data-category="1" data-rating="2">Rule of thirds / central alignment.</td>
            <td data-category="1" data-rating="3">Leading lines + dynamic contrast.</td>
            <td data-category="1" data-rating="4">Visually “readable” in under a second (esp. on mobile).</td>
          </tr>
          <!-- Simplicity vs. Clutter -->
          <tr>
            <td class="category-header" data-category="2">Simplicity vs. Clutter</td>
            <td data-category="2" data-rating="1">Some clarity; background elements distract.</td>
            <td data-category="2" data-rating="2">Clean layout, minimal clutter.</td>
            <td data-category="2" data-rating="3">Strong hierarchy, clear focal point.</td>
            <td data-category="2" data-rating="4">Perfect negative space usage; subject pops.</td>
          </tr>
          <!-- Text Clarity -->
          <tr>
            <td class="category-header" data-category="3">Text Clarity</td>
            <td data-category="3" data-rating="1">Legible but possibly too long.</td>
            <td data-category="3" data-rating="2">Short text, easy to read on mobile.</td>
            <td data-category="3" data-rating="3">Minimal, punchy text complements visuals.</td>
            <td data-category="3" data-rating="4">Perfect synergy; zero wasted words.</td>
          </tr>
          <!-- Curiosity Gap -->
          <tr>
            <td class="category-header" data-category="4">Curiosity Gap</td>
            <td data-category="4" data-rating="1">Hints at something interesting.</td>
            <td data-category="4" data-rating="2">Clear unanswered question.</td>
            <td data-category="4" data-rating="3">Strongly teases surprising element.</td>
            <td data-category="4" data-rating="4">Creates “What on earth?” scenario.</td>
          </tr>
          <!-- Emotional Impact -->
          <tr>
            <td class="category-header" data-category="5">Emotional Impact</td>
            <td data-category="5" data-rating="1">Neutral or mild interest.</td>
            <td data-category="5" data-rating="2">Sparks curiosity or excitement.</td>
            <td data-category="5" data-rating="3">Triggers FOMO, shock, or urgency.</td>
            <td data-category="5" data-rating="4">Visceral reaction (fear, awe, hilarity).</td>
          </tr>
          <!-- Thumbnail–Title Synergy -->
          <tr>
            <td class="category-header" data-category="6">Thumbnail–Title Synergy</td>
            <td data-category="6" data-rating="1">Doesn’t reinforce title.</td>
            <td data-category="6" data-rating="2">Hints at title’s topic.</td>
            <td data-category="6" data-rating="3">Combined “hook” effect.</td>
            <td data-category="6" data-rating="4">Seamless “one-two punch” with title.</td>
          </tr>
          <!-- Video Relevance -->
          <tr>
            <td class="category-header" data-category="7">Video Relevance</td>
            <td data-category="7" data-rating="1">Some alignment but somewhat clickbaity.</td>
            <td data-category="7" data-rating="2">Accurately represents main topic.</td>
            <td data-category="7" data-rating="3">Compelling moment without spoilers.</td>
            <td data-category="7" data-rating="4">Perfect alignment with content.</td>
          </tr>
          <!-- Branding & Consistency -->
          <tr>
            <td class="category-header" data-category="8">Branding &amp; Consistency</td>
            <td data-category="8" data-rating="1">Basic consistency with channel style.</td>
            <td data-category="8" data-rating="2">Visible brand elements.</td>
            <td data-category="8" data-rating="3">Immediately identifiable as your style.</td>
            <td data-category="8" data-rating="4">Instant brand recognition.</td>
          </tr>
          <!-- Technical Polish -->
          <tr>
            <td class="category-header" data-category="9">Technical Polish</td>
            <td data-category="9" data-rating="1">No pixelation, basic sizing.</td>
            <td data-category="9" data-rating="2">Mobile-friendly text/contrast.</td>
            <td data-category="9" data-rating="3">Studio-level precision.</td>
            <td data-category="9" data-rating="4">Flawless execution.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ========== FEEDBACK SECTION ========== -->
    <div class="feedback-panel glass-panel" id="feedback">
      <h3>Improvement Recommendations</h3>
      <div id="specificFeedback"></div>
      <div class="ai-suggestions" id="aiSuggestions"></div>
    </div>

    <!-- ========== AUTOMATIC INSIGHTS (Color Palette, etc.) ========== -->
    <div class="auto-insights glass-panel">
      <h3>Design Insights</h3>
      <div class="insight-message" id="contrastMessage"></div>
      <div class="insight-message" id="brightnessMessage"></div>
      <h4>Color Palette</h4>
      <p style="margin:0;">Dominant Colors Extracted:</p>
      <div id="paletteContainer" class="palette-container"></div>
    </div>

    <!-- ========== RESOURCES ========== -->
    <div class="resources glass-panel">
      <h3>Creation Resources</h3>
      <ul>
        <li><a href="https://creatoracademy.youtube.com/page/lesson/thumbnails" target="_blank">YouTube Thumbnail Guide</a></li>
        <li><a href="https://www.canva.com/create/youtube-thumbnails/" target="_blank">Free Thumbnail Maker</a></li>
        <li><a href="https://www.tubebuddy.com/thumbnail-tester" target="_blank">A/B Testing Tool</a></li>
      </ul>
      
      <!-- Optional: Heatmapping / Eye tracking embed or script 
           For example, you could add a snippet from Hotjar, Mouseflow, 
           or another service to visualize user interactions. -->
      <!-- 
      <script>
        // Example placeholder for heatmapping
        // Insert your third-party code here
      </script>
      -->
    </div>
  </div>

  <script>
    const improvementTips = {
      0: {
        1: "Use bigger contrasts or dynamic visuals to stop scrolling eyes.",
        2: "Add bright color(s) or a face/danger element to stand out.",
        3: "Combine multiple ‘scroll-stoppers’ (e.g. big text + dramatic photo).",
        4: "You’re hitting MUST-CLICK levels; keep testing new combos."
      },
      1: {
        1: "Consider rule of thirds or central alignment to guide the eye.",
        2: "Use leading lines or shapes to draw attention to your subject.",
        3: "Check color contrast & negative space for a dynamic layout.",
        4: "Awesome composition—instantly readable on any device."
      },
      2: {
        1: "Remove busy backgrounds or reduce extra elements.",
        2: "Keep only the essential elements to focus the viewer.",
        3: "Use ample whitespace to highlight the main subject.",
        4: "Clean, bold, and minimal—perfect for rapid consumption."
      },
      3: {
        1: "Shorten text, or enlarge it for better visibility.",
        2: "Make text concise, with strong contrast vs. background.",
        3: "Use a big, bold font that reads well on mobile.",
        4: "Perfect synergy: text is minimal, super clear, & complements visuals."
      },
      4: {
        1: "Suggest a hidden surprise or an open question.",
        2: "Spark curiosity with partial info in text or visuals.",
        3: "Use a weird or dramatic element to raise questions.",
        4: "Huge ‘What’s going on here?!’ vibe—very click-enticing."
      },
      5: {
        1: "Try adding a more dramatic facial expression or scenario.",
        2: "Highlight shock, awe, joy, or strong emotion.",
        3: "Use vivid colors or action to spark immediate emotion.",
        4: "Fantastic emotional punch. People can’t look away!"
      },
      6: {
        1: "Thumbnail doesn’t fully match the title—tighten synergy.",
        2: "Hint visually what your title states verbally.",
        3: "Title + thumbnail should each reinforce curiosity or value.",
        4: "Perfect synergy: they work together seamlessly."
      },
      7: {
        1: "Feels clickbaity or incomplete. Show real relevant subject.",
        2: "Thumbnail matches the main topic well.",
        3: "Tease the best moment without spoiling everything.",
        4: "Perfect alignment—delivers exactly what the viewer expects."
      },
      8: {
        1: "Use your channel color or style more consistently.",
        2: "Include a subtle brand/logo watermark.",
        3: "Style is clearly yours—repeat typography/colors.",
        4: "Viewers immediately recognize your brand from a glance."
      },
      9: {
        1: "Check resolution or scaling to avoid blur/pixelation.",
        2: "Ensure text is legible on small screens—check color contrast.",
        3: "All elements are crisp, well-spaced, and professional.",
        4: "Flawless polish. Looks studio-grade at any size."
      }
    };

    let scores = {};

    // On page load, attach click handlers for the rubric
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll('.modern-table td[data-rating]').forEach(cell => {
        cell.addEventListener('click', () => selectRating(cell));
      });
      
      // Handle thumbnail uploads
      document.getElementById('thumbnailUpload').addEventListener('change', handleImageUpload);
      // Title changes
      document.getElementById('videoTitle').addEventListener('input', () => {
        updateTitlePreview();
        checkTitleThumbnailSynergy();
      });
    });

    function selectRating(cell) {
      const categoryIndex = Number(cell.getAttribute('data-category'));
      const rating = parseInt(cell.getAttribute('data-rating'));

      // Clear selection on the row
      const row = cell.parentElement;
      row.querySelectorAll('td').forEach(td => {
        if(td !== row.firstElementChild) td.classList.remove('selected');
      });

      // Mark this cell
      cell.classList.add('selected');
      scores[categoryIndex] = rating;
      
      updateTotal();
      showFeedback();
    }

    function updateTotal() {
      const total = Object.values(scores).reduce((a, b) => a + b, 0);
      document.getElementById('total').textContent = total;

      const ranking = document.getElementById('ranking');
      if (Object.keys(scores).length < 10) {
        ranking.textContent = 'Incomplete';
        ranking.style.color = '#64748b';
        return;
      }
      // Full 10 categories selected
      if (total <= 24) {
        ranking.textContent = 'Needs Work 🔴';
        ranking.style.color = '#ef4444';
      } else if (total <= 32) {
        ranking.textContent = 'Good Start 🟡';
        ranking.style.color = '#eab308';
      } else if (total <= 38) {
        ranking.textContent = 'Great! 🟢';
        ranking.style.color = '#22c55e';
      } else {
        ranking.textContent = 'Perfect! 🔵';
        ranking.style.color = '#3b82f6';
      }
    }

    function showFeedback() {
      const feedbackDiv = document.getElementById('specificFeedback');
      feedbackDiv.innerHTML = Object.keys(scores).map(cat => {
        const rating = scores[cat];
        const categoryName = document.querySelector(`[data-category="${cat}"].category-header`).textContent;
        return `
          <div class="feedback-item">
            <strong>${categoryName}</strong>:
            <span>${improvementTips[cat][rating]}</span>
          </div>`;
      }).join('');
    }

    function resetScores() {
      scores = {};
      document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
      document.getElementById('specificFeedback').innerHTML = '';
      updateTotal();
      const ranking = document.getElementById('ranking');
      ranking.textContent = 'Incomplete';
      ranking.style.color = '#64748b';
    }

    /* ========== TITLE PREVIEW ========== */
    let debounceTimer;
    function updateTitlePreview() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const title = document.getElementById('videoTitle').value;
        const preview = document.getElementById('titlePreview');
        // Simple highlight of each word as 'keyword'
        preview.innerHTML = title.replace(/(\w+)/g, '<span class="keyword">$1</span>');

        // Update the actual-size previews to replicate how YouTube might display
        document.getElementById('homeTitle').textContent = title;
        document.getElementById('suggestedTitle').textContent = title;
        document.getElementById('mobileTitle').textContent = title;
      }, 300);
    }

    function checkTitleThumbnailSynergy() {
      // Just a naive synergy check—number of overlapping words
      const title = document.getElementById('videoTitle').value.toLowerCase();
      const synergyScore = title ? 1 : 0; 
      // You could parse text from the thumbnail if needed or more advanced checks
      // If synergyScore < some threshold => highlight synergy category
      // E.g.:
      if (synergyScore < 1) {
        // Mark synergy as low, or something similar
        // For example, color the synergy row:
        // document.querySelector('[data-category="6"].category-header').style.backgroundColor = "#ffd6d6";
      }
    }

    /* ========== THUMBNAIL UPLOAD & PREVIEWS ========== */
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        const dataUrl = ev.target.result;
        document.getElementById('homePreview').src = dataUrl;
        document.getElementById('suggestedPreview').src = dataUrl;
        document.getElementById('mobilePreview').src = dataUrl;

        // Trigger color palette extraction
        extractColors(dataUrl);

        // We can also do simple brightness/contrast checks
        // after the image is loaded into an <img> or a canvas, etc.
        setTimeout(() => {
          checkContrastAndBrightness(dataUrl);
        }, 300);
      };
      reader.readAsDataURL(file);
    }

    /* ========== COLOR PALETTE EXTRACTION ========== */
    function extractColors(imageSrc) {
      const paletteContainer = document.getElementById('paletteContainer');
      paletteContainer.innerHTML = 'Detecting palette…';

      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.src = imageSrc;
      img.onload = function() {
        const colorThief = new ColorThief();
        try {
          // getPalette(img, colorCount=6, quality=10)
          const palette = colorThief.getPalette(img, 6);
          paletteContainer.innerHTML = palette.map(color => {
            const rgb = `rgb(${color[0]},${color[1]},${color[2]})`;
            return `<div class="color-swatch" style="background-color:${rgb}" title="${rgb}"></div>`;
          }).join('');
        } catch (err) {
          paletteContainer.innerHTML = 'Unable to extract palette.';
        }
      };
    }

    /* ========== SIMPLE BRIGHTNESS/CONTRAST CHECK ========== */
    function checkContrastAndBrightness(imageSrc) {
      const brightnessMessage = document.getElementById('brightnessMessage');
      const contrastMessage = document.getElementById('contrastMessage');

      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.src = imageSrc;
      img.onload = function() {
        // Draw onto a canvas
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let total = 0, count = 0;
        
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i], g = data[i+1], b = data[i+2];
          // Perceived brightness formula: 0.299r + 0.587g + 0.114b
          const brightness = (0.299 * r + 0.587 * g + 0.114 * b);
          total += brightness;
          count++;
        }
        const avgBrightness = total / count; // 0-255 scale
        brightnessMessage.textContent = 
          `Average Brightness: ${Math.round(avgBrightness)}/255`;

        // Simple rule-of-thumb
        if (avgBrightness < 80) {
          brightnessMessage.textContent += " (Very Dark).";
        } else if (avgBrightness < 160) {
          brightnessMessage.textContent += " (Moderate).";
        } else {
          brightnessMessage.textContent += " (Bright).";
        }

        // If you wanted to check contrast with a typical background color or text color, 
        // you'd do a ratio check here. We’ll just do a placeholder message:
        contrastMessage.textContent = "Check text vs. background colors to ensure 4.5:1 contrast ratio if text is small.";
      };
    }

    /* ========== AI SUGGESTIONS (SIMULATED) ========== */
    async function getAISuggestions() {
      const aiDiv = document.getElementById('aiSuggestions');
      aiDiv.innerHTML = '<div class="loading-spinner">⏳</div> Analyzing...';
      // Simulate a 2s wait, then show suggestions
      setTimeout(() => {
        const suggestions = [
          "Add a large, expressive face for immediate emotional hook.",
          "Emphasize a single word in your text with a contrasting color.",
          "Use a bold arrow or shape pointing to the focal subject.",
          "Consider adding a brand watermark or consistent corner element.",
          "Crop the background to remove any distracting edges."
        ];
        aiDiv.innerHTML = '<strong>AI Recommendations:</strong><br>' +
          suggestions.map(s => `• ${s}`).join('<br>');
      }, 2000);
    }

    /* ========== EXPORT TO PDF ========== */
    async function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');

      const elements = [
        document.querySelector('.analyzer-header'),
        document.querySelector('.preview-section'),
        document.querySelector('.rubric-table'),
        document.querySelector('#feedback'),
        document.querySelector('.auto-insights'),
      ];

      let yPos = 10;
      for (const element of elements) {
        const canvas = await html2canvas(element, { scale: 2 });
        const imgData = canvas.toDataURL('image/png');
        const imgProps = doc.getImageProperties(imgData);
        const pdfWidth = doc.internal.pageSize.getWidth() - 20;
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        if (yPos + pdfHeight > doc.internal.pageSize.getHeight()) {
          doc.addPage();
          yPos = 10;
        }
        doc.addImage(imgData, 'PNG', 10, yPos, pdfWidth, pdfHeight);
        yPos += pdfHeight + 10;
      }

      doc.save('thumbnail-analysis-report.pdf');
    }

    /* ========== THEME TOGGLE ========== */
    function toggleTheme() {
      const htmlEl = document.documentElement;
      if (htmlEl.getAttribute('data-theme') === 'dark') {
        htmlEl.removeAttribute('data-theme');
      } else {
        htmlEl.setAttribute('data-theme', 'dark');
      }
    }
  </script>
</body>
</html>
