<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Idea Forge Pro | Viral Content Generator</title>
  <!-- Added html2canvas library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary: #10B981;
      --secondary: #059669;
      --accent: #F59E0B;
      --gradient: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      --glass: rgba(255, 255, 255, 0.98);
      --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --radius: 16px;
      --text-primary: #1F2937;
      --text-secondary: #4B5563;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
      background: #F3F4F6;
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    /* HEADER */
    .analyzer-header {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: sticky;
      top: 1rem;
      z-index: 100;
    }
    
    .score-display {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }
    
    .total-score {
      font-size: 1.75rem;
      font-weight: 700;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }
    
    .controls {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.15);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
    }
    
    /* BRAINSTORM / IDEA SECTION */
    .brainstorm-section {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .brainstorm-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .brainstorm-header h2 {
      margin: 0;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    #ideaInput {
      width: 100%;
      height: 150px;
      padding: 1.5rem;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      margin: 1rem 0;
      font-size: 1rem;
      resize: vertical;
      transition: var(--transition);
      background: rgba(249, 250, 251, 0.8);
    }
    
    #ideaInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }
    
    .idea-preview {
      background: #fff;
      border: 1px solid #E5E7EB;
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
      font-size: 1rem;
      color: var(--text-secondary);
    }
    
    .word-count {
      text-align: right;
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }
    
    .prompt-generator {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: rgba(245, 158, 11, 0.05);
      border-radius: var(--radius);
      border: 1px solid rgba(245, 158, 11, 0.1);
    }
    
    /* Revision History */
    .revision-history {
      margin-top: 1rem;
      background: #fff;
      border: 1px solid #E5E7EB;
      border-radius: var(--radius);
      padding: 0.75rem;
      max-height: 150px;
      overflow-y: auto;
      font-size: 0.9rem;
    }
    
    .revision-history li {
      cursor: pointer;
      margin: 0.25rem 0;
      padding: 0.25rem;
    }
    
    .clear-btn {
      background: #F87171;
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .clear-btn:hover {
      background: #EF4444;
    }
    
    /* RUBRIC TABLE */
    .rubric-table {
      background: var(--glass);
      border-radius: var(--radius);
      margin: 2rem 0;
      box-shadow: var(--shadow);
      overflow-x: auto;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .modern-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 800px;
    }
    
    .modern-table th {
      background: var(--gradient);
      color: white;
      padding: 1.25rem;
      font-weight: 600;
      position: sticky;
      top: 0;
      backdrop-filter: blur(10px);
    }
    
    .modern-table td {
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid rgba(229, 231, 235, 0.3);
      transition: var(--transition);
      vertical-align: top;
      min-width: 200px;
      cursor: pointer;
    }
    
    .category-header {
      font-weight: 600;
      background: rgba(16, 185, 129, 0.08);
      position: sticky;
      left: 0;
      min-width: 180px;
      backdrop-filter: blur(5px);
      border-right: 1px solid rgba(229, 231, 235, 0.3);
      /* Tooltip for additional guidance */
      cursor: help;
    }
    
    .modern-table td:not(.category-header):hover {
      background: rgba(209, 250, 229, 0.3);
      transform: scale(1.02);
    }
    
    .selected {
      background: rgba(209, 250, 229, 0.5) !important;
      box-shadow: inset 4px 0 0 var(--primary);
      transform: scale(1.02);
    }
    
    /* FEEDBACK PANEL & RESOURCES */
    .feedback-panel, .resources {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      margin: 2rem 0;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .ai-suggestions {
      background: rgba(245, 158, 11, 0.05);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 1.5rem;
      border: 1px solid rgba(245, 158, 11, 0.1);
    }
    
    /* RESOURCES */
    .resources h3 {
      margin-top: 0;
    }
    
    .resources ul {
      margin: 1rem 0 0 1.5rem;
    }
    
    /* HOW-TO MODAL */
    .modal-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 1rem;
    }
    
    .modal-bg.show {
      display: flex;
    }
    
    .modal-content {
      position: relative;
      background: #fff;
      border-radius: var(--radius);
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      padding: 1.5rem;
    }
    
    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close-btn:hover {
      background: rgba(255,255,255,1);
    }
    
    /* Loading spinner for AI suggestions */
    .loading-spinner {
      display: inline-block;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 0 1rem;
      }
      .modern-table th, .modern-table td {
        padding: 1rem;
        min-width: 160px;
      }
      .category-header {
        min-width: 140px;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="analyzer-header">
    <div class="score-display">
      <div class="total-score">Score: <span id="total">0</span>/40</div>
      <div class="status-indicator" id="ranking">Incomplete</div>
    </div>
    <div class="controls">
      <button onclick="resetScores()">üîÑ Reset Scores</button>
      <button onclick="exportPDF()">üì• Export Report</button>
      <button onclick="getAISuggestions()">ü§ñ AI Suggestions</button>
      <button onclick="openHowTo()">‚ùì How To</button>
    </div>
  </div>
  
  <!-- BRAINSTORM / IDEA SECTION -->
  <div class="brainstorm-section">
    <div class="brainstorm-header">
      <svg class="spark-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="28" height="28">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
      </svg>
      <h2>Idea Incubator</h2>
    </div>
    <textarea id="ideaInput" placeholder="‚ú® Describe your video concept here..."></textarea>
    <div class="word-count" id="ideaWordCount">0 words, 0 characters</div>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
      <button class="clear-btn" onclick="clearIdea()">Clear Idea</button>
      <button class="clear-btn" onclick="copyIdea()">üìã Copy Idea</button>
      <button class="clear-btn" onclick="saveRevision()">üíæ Save Revision</button>
    </div>
    <ul class="revision-history" id="revisionHistory"></ul>
    <button class="clear-btn" onclick="clearRevisions()">Clear Revision History</button>
    <div class="idea-preview" id="ideaPreview">Live Preview: Your idea will appear here as you type.</div>
    
    <div class="prompt-generator">
      <button onclick="generatePrompt()">üé≤ Random Prompt</button>
      <div id="randomPrompt" class="idea-prompt"></div>
    </div>
  </div>
  
  <!-- RUBRIC TABLE -->
  <div class="rubric-table">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Category</th>
          <th>Good (1)</th>
          <th>Great (2)</th>
          <th>Excellent (3)</th>
          <th>Outstanding (4)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Originality & Concept -->
        <tr>
          <td class="category-header" data-category="0" title="How unique and intriguing is the idea?">Originality &amp; Concept</td>
          <td data-category="0" data-rating="1">Basic, generic idea</td>
          <td data-category="0" data-rating="2">Some intrigue but needs refinement</td>
          <td data-category="0" data-rating="3">Engaging with clear potential</td>
          <td data-category="0" data-rating="4">Exceptionally bold &amp; entertaining</td>
        </tr>
        <!-- Transformation/Progression -->
        <tr>
          <td class="category-header" data-category="1" title="How well does the idea develop or transform?">Transformation/Progression</td>
          <td data-category="1" data-rating="1">No clear growth</td>
          <td data-category="1" data-rating="2">Mild progression</td>
          <td data-category="1" data-rating="3">Clear transformation</td>
          <td data-category="1" data-rating="4">Dramatic, impactful progression</td>
        </tr>
        <!-- Engagement Potential -->
        <tr>
          <td class="category-header" data-category="2" title="Will the idea trigger interactions?">Engagement Potential</td>
          <td data-category="2" data-rating="1">No interaction triggers</td>
          <td data-category="2" data-rating="2">Might get likes</td>
          <td data-category="2" data-rating="3">Encourages interaction</td>
          <td data-category="2" data-rating="4">High engagement factor</td>
        </tr>
        <!-- Binge & Algorithm Fuel -->
        <tr>
          <td class="category-header" data-category="3" title="Does the idea lend itself to series or algorithm boosting?">Binge &amp; Algorithm Fuel</td>
          <td data-category="3" data-rating="1">One-off video</td>
          <td data-category="3" data-rating="2">Basic teaser</td>
          <td data-category="3" data-rating="3">Multi-part cliffhanger</td>
          <td data-category="3" data-rating="4">Unfinished business hook</td>
        </tr>
        <!-- WOW Factor -->
        <tr>
          <td class="category-header" data-category="4" title="How many 'aha' moments does the idea offer?">WOW Factor</td>
          <td data-category="4" data-rating="1">Standard presentation</td>
          <td data-category="4" data-rating="2">Some cool moments</td>
          <td data-category="4" data-rating="3">Standout moments</td>
          <td data-category="4" data-rating="4">Mind-blowing moments</td>
        </tr>
        <!-- Emotional Impact -->
        <tr>
          <td class="category-header" data-category="5" title="How emotionally resonant is the idea?">Emotional Impact</td>
          <td data-category="5" data-rating="1">Flat tone</td>
          <td data-category="5" data-rating="2">Occasional laughs</td>
          <td data-category="5" data-rating="3">Emotional rollercoaster</td>
          <td data-category="5" data-rating="4">Visceral reactions</td>
        </tr>
        <!-- Trend Potential -->
        <tr>
          <td class="category-header" data-category="6" title="Does the idea tap into current or future trends?">Trend Potential</td>
          <td data-category="6" data-rating="1">Misses trends</td>
          <td data-category="6" data-rating="2">Loosely aligned</td>
          <td data-category="6" data-rating="3">Viral alignment</td>
          <td data-category="6" data-rating="4">Trend-setting</td>
        </tr>
        <!-- Replayability -->
        <tr>
          <td class="category-header" data-category="7" title="Will viewers want to revisit or share this idea?">Replayability</td>
          <td data-category="7" data-rating="1">Forgettable</td>
          <td data-category="7" data-rating="2">Somewhat shareable</td>
          <td data-category="7" data-rating="3">Highly shareable</td>
          <td data-category="7" data-rating="4">Meme-worthy</td>
        </tr>
        <!-- Audience Alignment -->
        <tr>
          <td class="category-header" data-category="8" title="How well does the idea match the target audience?">Audience Alignment</td>
          <td data-category="8" data-rating="1">Too generic</td>
          <td data-category="8" data-rating="2">Mildly resonates</td>
          <td data-category="8" data-rating="3">Clear alignment</td>
          <td data-category="8" data-rating="4">Perfect alignment</td>
        </tr>
        <!-- Execution Feasibility -->
        <tr>
          <td class="category-header" data-category="9" title="How realistic is it to execute the idea?">Execution Feasibility</td>
          <td data-category="9" data-rating="1">Impractical</td>
          <td data-category="9" data-rating="2">Possible but difficult</td>
          <td data-category="9" data-rating="3">Practical with ROI</td>
          <td data-category="9" data-rating="4">Easy &amp; high ROI</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- FEEDBACK PANEL -->
  <div class="feedback-panel" id="feedback">
    <h3>Improvement Recommendations</h3>
    <div id="specificFeedback"></div>
    <div class="ai-suggestions" id="aiSuggestions"></div>
  </div>
  
  <!-- RESOURCES -->
  <div class="resources">
    <h3>Idea Generation Resources</h3>
    <ul>
      <li><a href="https://trends.google.com/trends/" target="_blank">Google Trends</a></li>
      <li><a href="https://answerthepublic.com/" target="_blank">Audience Questions</a></li>
      <li><a href="https://www.reddit.com/r/VideoIdeas/" target="_blank">Idea Community</a></li>
    </ul>
  </div>
  
  <!-- HOW-TO MODAL -->
  <div class="modal-bg" id="howToModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeHowTo()">‚úï</span>
      <h2>How to Use Idea Forge Pro</h2>
      <ul>
        <li>Type or paste your video concept in the Idea Incubator.</li>
        <li>Watch the live preview and word/character count update as you type.</li>
        <li>Use the "Save Revision" button to record versions of your idea.</li>
        <li>Click on a revision from the list to load it back into the editor.</li>
        <li>Generate random prompts for inspiration with the "Random Prompt" button.</li>
        <li>Rate your idea using the rubric table and review detailed improvement recommendations below.</li>
        <li>Use the AI Suggestions button for automated feedback.</li>
        <li>Export your complete report as a PDF when you‚Äôre ready.</li>
      </ul>
    </div>
  </div>
  
  <script>
    /***************************************************
     * Improvement Tips for Rubric (10 Categories)
     * Each recommendation now provides actionable steps.
     ***************************************************/
    const improvementTips = {
      0: {
        1: "Your idea appears too generic. Brainstorm by listing 'what if' scenarios to add an unexpected twist. Explore examples from various genres to find unconventional angles.",
        2: "There‚Äôs some uniqueness here. Try merging two unrelated concepts or subverting a common trope. Sketch out a mind-map to see new connections.",
        3: "Great originality! Enhance the concept by refining details and establishing a clear hook. Consider early surprises that capture attention.",
        4: "Outstanding originality! Focus on fine-tuning every element. Develop detailed visuals and consider how innovative storytelling can amplify the concept."
      },
      1: {
        1: "The idea lacks clear progression. Outline a basic three-act structure (beginning, middle, end) and consider using storyboards to visualize the flow.",
        2: "The narrative shows growth but needs depth. Identify key turning points and add tension by introducing obstacles and conflicts.",
        3: "Solid progression. Elevate it by incorporating dynamic character arcs and unexpected plot twists that deepen the narrative.",
        4: "Excellent progression! Enhance by mapping out subplots and secondary conflicts that enrich the storyline and maintain momentum."
      },
      2: {
        1: "The concept doesn‚Äôt encourage interaction. Introduce open-ended questions or dilemmas that invite viewers to share their thoughts.",
        2: "There is some engagement potential. Consider adding relatable characters or dilemmas that prompt audience discussion, perhaps through social media challenges.",
        3: "Good engagement. Boost it by integrating interactive segments‚Äîthink polls, Q&As, or live feedback moments.",
        4: "High engagement potential! Optimize by designing interactive storytelling techniques and call-to-action moments that directly involve your audience."
      },
      3: {
        1: "The idea feels like a one-off. Brainstorm ways to expand it into a series, maybe by introducing ongoing mysteries or unresolved storylines.",
        2: "There‚Äôs a teaser quality but it lacks depth. Develop cliffhangers or episodic arcs that compel viewers to return for more.",
        3: "Solid series potential. Plan character development and overarching storylines that can evolve over multiple episodes.",
        4: "Outstanding for series development! Consider creating a detailed episodic roadmap and weaving subplots that maintain long-term interest."
      },
      4: {
        1: "The WOW factor is minimal. Experiment with creative visuals or narrative twists that defy expectations, such as surprise cameos or plot reversals.",
        2: "Some impressive moments are present. Amplify these by emphasizing high-impact visuals or sound design that create memorable moments.",
        3: "Strong WOW moments! Enhance them by polishing your standout elements through innovative editing and creative production techniques.",
        4: "Incredible WOW factor! Keep pushing boundaries‚Äîuse avant-garde techniques and challenge conventional storytelling to leave viewers amazed."
      },
      5: {
        1: "The emotional impact is flat. Introduce personal anecdotes, real stakes, or high-drama moments that evoke empathy.",
        2: "There's a hint of emotion. Deepen the impact by exploring character vulnerabilities and conflicts that touch on universal themes.",
        3: "A powerful emotional journey. Enhance by adding dynamic tone shifts and moments of genuine human connection.",
        4: "Deeply moving and impactful! Refine by injecting authenticity and real-life stakes, ensuring every emotional beat is deliberate and resonant."
      },
      6: {
        1: "Your idea isn‚Äôt tapping into trends. Research emerging topics and think about how current events or cultural shifts can inform your concept.",
        2: "The idea loosely aligns with trends. Strengthen it by integrating popular elements with your unique twist‚Äîmaybe reference viral challenges or memes.",
        3: "Good trend alignment. Forecast upcoming trends and subtly weave them into your narrative to give your content a timely edge.",
        4: "Trend-setting! Continue to innovate by blending current trends with original concepts that could redefine your genre."
      },
      7: {
        1: "The idea isn‚Äôt very shareable. Reflect on what makes content go viral‚Äîemotion, surprise, and relatability‚Äîand incorporate these elements.",
        2: "There‚Äôs potential for shareability. Create memorable, quotable moments and striking visuals that encourage viewers to spread the word.",
        3: "Highly shareable concept. Optimize by ensuring your content is easily digestible and formatted for social sharing, with clear takeaways.",
        4: "Exceptionally shareable! Consider adding interactive challenges or call-to-actions that actively invite your audience to share and engage."
      },
      8: {
        1: "The idea might be too generic for your audience. Revisit your audience research and tailor the content to their interests and language.",
        2: "There‚Äôs some audience alignment. Strengthen it by integrating community feedback and referencing topics that your viewers are passionate about.",
        3: "Good alignment with your audience. Fine-tune by using familiar references, humor, or language that resonates directly with your demographic.",
        4: "Perfect alignment! Engage with your community to co-create elements of the narrative, ensuring your idea remains both relevant and authentic."
      },
      9: {
        1: "The execution appears impractical. Simplify the concept and focus on what can realistically be produced given your resources.",
        2: "Execution is challenging. Look for ways to streamline production‚Äîconsider using affordable tools, outsourcing certain elements, or planning a minimalistic approach.",
        3: "Practical with clear ROI. Enhance by mapping out a detailed production plan, including timelines, budgets, and contingency strategies.",
        4: "Effortless execution with high ROI! Consider innovative production techniques or strategic collaborations that can elevate your final product without overextending resources."
      }
    };
    
    /***************************************************
     * Global Variables & Revision History
     ***************************************************/
    let scores = {};
    let revisions = [];
    let saveDraftTimeout;
    
    /***************************************************
     * Expanded Random Prompts for Creative Inspiration
     ***************************************************/
    const prompts = [
      "What if you combined an unexpected historical event with futuristic technology?",
      "Imagine a world where your video genre is completely inverted‚Äîwhat fresh perspective emerges?",
      "How could you tell your story if you started at the climax and unraveled the events backwards?",
      "What if you introduced a mysterious character whose secret changes everything?",
      "Imagine blending two completely different genres‚Äîwhat unique narrative could form?",
      "What would your story look like if told by an unreliable narrator with hidden motives?",
      "Consider a twist where the villain becomes the hero. How would that reshape your narrative?",
      "What if your content involved interactive viewer choices that shape the storyline in real time?",
      "How can you incorporate elements of mystery and suspense to hook your audience from the start?",
      "What if you used a non-linear narrative to reveal different perspectives on the same event?",
      "Imagine your idea as a serialized mystery‚Äîwhat cliffhanger would you end each episode with?",
      "How would your concept change if you mixed reality with surreal, dream-like sequences?",
      "What if your video opened with a controversial statement and then built credibility through evidence?",
      "Imagine your content as a journey of transformation. What key stages would your character experience?",
      "How could you incorporate user-generated content to make your narrative more dynamic and relatable?",
      "What if you narrated your idea from an unexpected perspective, such as an inanimate object?",
      "Consider a scenario where every decision has a visible consequence. How would you structure that?",
      "How can you integrate a live element into your content to create authentic real-time engagement?",
      "What if you challenged a common stereotype or myth‚Äîhow would you flip the narrative?",
      "Imagine your narrative as a puzzle with clues scattered throughout. How would you arrange them?",
      "How would you use visual metaphors to add layers of meaning to your concept?",
      "What if you reimagined a familiar story in a futuristic setting with a radical twist?",
      "Consider a scenario where technology and raw emotion collide‚Äîhow would that shape your story?"
    ];
    
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved draft (if any)
      const savedDraft = localStorage.getItem('ideaDraft');
      if(savedDraft) {
        document.getElementById('ideaInput').value = savedDraft;
        updateIdea();
      }
      // Load saved revisions
      const savedRevisions = localStorage.getItem('ideaRevisions');
      if(savedRevisions) {
        revisions = JSON.parse(savedRevisions);
        updateRevisionHistory();
      }
      // Set up event listeners
      document.querySelectorAll('.modern-table td[data-rating]').forEach(cell => {
        cell.addEventListener('click', () => selectRating(cell));
      });
      document.getElementById('ideaInput').addEventListener('input', updateIdea);
      generatePrompt();
      
      // Close How-To modal on Escape key press
      document.addEventListener('keydown', function(e) {
        if(e.key === "Escape" && document.getElementById('howToModal').classList.contains('show')) {
          closeHowTo();
        }
      });
    });
    
    /***************************************************
     * Rubric Score Functions
     ***************************************************/
    function selectRating(cell) {
      const categoryIndex = Number(cell.getAttribute('data-category'));
      const rating = parseInt(cell.getAttribute('data-rating'));
      const row = cell.parentElement;
      row.querySelectorAll('td').forEach(td => {
        if(td !== row.firstElementChild) td.classList.remove('selected');
      });
      cell.classList.add('selected');
      scores[categoryIndex] = rating;
      updateTotal();
      showFeedback();
    }
    
    function updateTotal() {
      const total = Object.values(scores).reduce((a, b) => a + b, 0);
      document.getElementById('total').textContent = total;
      const ranking = document.getElementById('ranking');
      
      if(Object.keys(scores).length < 10) {
        ranking.textContent = 'Incomplete';
        ranking.style.color = '#64748b';
        return;
      }
      
      if(total <= 24) {
        ranking.textContent = 'Needs Work üî¥';
        ranking.style.color = '#ef4444';
      } else if(total <= 32) {
        ranking.textContent = 'Good Start üü°';
        ranking.style.color = '#eab308';
      } else if(total <= 38) {
        ranking.textContent = 'Great! üü¢';
        ranking.style.color = '#22c55e';
      } else {
        ranking.textContent = 'Perfect! üîµ';
        ranking.style.color = '#3b82f6';
      }
    }
    
    function showFeedback() {
      const feedbackDiv = document.getElementById('specificFeedback');
      feedbackDiv.innerHTML = Object.keys(scores).map(cat => {
        const rating = scores[cat];
        // Look up the category header using the data-category attribute
        const header = document.querySelector(`.category-header[data-category="${cat}"]`);
        const categoryName = header ? header.textContent.trim() : 'Category ' + cat;
        return `<div class="feedback-item" style="margin: 0.5rem 0; padding: 1rem; background: rgba(16, 185, 129, 0.05); border-radius: 8px;">
                  <strong style="color: ${getCategoryColor(cat)}">${categoryName}:</strong>
                  <span style="color: #475569;"> ${improvementTips[cat][rating]}</span>
                </div>`;
      }).join('');
    }
    
    function getCategoryColor(cat) {
      const colors = ['#10B981', '#F59E0B', '#3B82F6', '#8B5CF6', '#EC4899', 
                      '#EF4444', '#14B8A6', '#84CC16', '#64748B', '#6366F1'];
      return colors[Number(cat)];
    }
    
    function resetScores() {
      scores = {};
      document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
      document.getElementById('specificFeedback').innerHTML = '';
      updateTotal();
      document.getElementById('ranking').textContent = 'Incomplete';
      document.getElementById('ranking').style.color = '#64748b';
    }
    
    /***************************************************
     * Prompt Generator
     ***************************************************/
    function generatePrompt() {
      const random = prompts[Math.floor(Math.random() * prompts.length)];
      document.getElementById('randomPrompt').textContent = random;
    }
    
    /***************************************************
     * Idea Input: Live Word/Character Count, Preview & Auto-save Draft
     ***************************************************/
    function updateIdea() {
      const ideaText = document.getElementById('ideaInput').value;
      updateWordCount(ideaText);
      updateIdeaPreview(ideaText);
      // Auto-save draft after 500ms of inactivity
      clearTimeout(saveDraftTimeout);
      saveDraftTimeout = setTimeout(() => {
        localStorage.setItem('ideaDraft', ideaText);
      }, 500);
    }
    
    function updateWordCount(text) {
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      const characters = text.length;
      document.getElementById('ideaWordCount').textContent = `${words} words, ${characters} characters`;
    }
    
    function updateIdeaPreview(text) {
      const preview = text ? text.replace(/\n/g, '<br>') : "Live Preview: Your idea will appear here as you type.";
      document.getElementById('ideaPreview').innerHTML = preview;
    }
    
    function clearIdea() {
      document.getElementById('ideaInput').value = '';
      updateIdea();
    }
    
    function saveRevision() {
      const ideaText = document.getElementById('ideaInput').value;
      if(!ideaText.trim()) return;
      const timestamp = new Date().toLocaleString();
      revisions.push({ text: ideaText, time: timestamp });
      localStorage.setItem('ideaRevisions', JSON.stringify(revisions));
      updateRevisionHistory();
    }
    
    function updateRevisionHistory() {
      const revList = document.getElementById('revisionHistory');
      revList.innerHTML = revisions.map((rev, index) => `<li onclick="loadRevision(${index})">Revision ${index+1} - ${rev.time}</li>`).join('');
    }
    
    function loadRevision(index) {
      if(confirm("Load this revision? Unsaved changes will be lost.")) {
        document.getElementById('ideaInput').value = revisions[index].text;
        updateIdea();
      }
    }
    
    function clearRevisions() {
      if(confirm("Are you sure you want to clear all revision history?")) {
        revisions = [];
        updateRevisionHistory();
        localStorage.removeItem('ideaRevisions');
      }
    }
    
    /***************************************************
     * AI Suggestions Simulation
     ***************************************************/
    async function getAISuggestions() {
      const aiDiv = document.getElementById('aiSuggestions');
      aiDiv.innerHTML = '<div class="loading-spinner">‚è≥</div> Analyzing concept...';
      setTimeout(() => {
        const suggestions = [
          "Add a personal story to increase relatability.",
          "Include a surprising twist in the first 30 seconds.",
          "Create a recurring character for series potential.",
          "Add data visualization for credibility.",
          "Use trending audio to boost discoverability."
        ];
        aiDiv.innerHTML = '<strong>AI Recommendations:</strong><br>' + suggestions.map(s => `‚Ä¢ ${s}`).join('<br>');
      }, 2000);
    }
    
    /***************************************************
     * EXPORT PDF
     ***************************************************/
    async function exportPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const elements = [
          document.querySelector('.analyzer-header'),
          document.querySelector('.brainstorm-section'),
          document.querySelector('.rubric-table'),
          document.querySelector('.feedback-panel')
        ];
        
        let yPos = 10;
        for(const element of elements) {
          const canvas = await html2canvas(element, { scale: 2 });
          const imgData = canvas.toDataURL('image/png');
          const imgProps = doc.getImageProperties(imgData);
          const pdfWidth = doc.internal.pageSize.getWidth() - 20;
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          if(yPos + pdfHeight > doc.internal.pageSize.getHeight()) {
            doc.addPage();
            yPos = 10;
          }
          doc.addImage(imgData, 'PNG', 10, yPos, pdfWidth, pdfHeight);
          yPos += pdfHeight + 10;
        }
        doc.save('idea-analysis-report.pdf');
      } catch (error) {
        console.error("Error exporting PDF: ", error);
        alert("Failed to export PDF. Please try again.");
      }
    }
    
    /***************************************************
     * HOW-TO MODAL FUNCTIONS
     ***************************************************/
    function openHowTo() {
      document.getElementById('howToModal').classList.add('show');
    }
    
    function closeHowTo() {
      document.getElementById('howToModal').classList.remove('show');
    }
    
    /***************************************************
     * Copy Idea Functionality
     ***************************************************/
    function copyIdea() {
      const ideaText = document.getElementById('ideaInput').value;
      if(ideaText.trim()) {
        navigator.clipboard.writeText(ideaText)
          .then(() => alert('Idea copied to clipboard!'))
          .catch(err => alert('Failed to copy text: ' + err));
      }
    }
  </script>
</body>
</html>
