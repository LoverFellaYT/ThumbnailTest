<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Idea Forge Pro | Viral Content Generator</title>
  <!-- Added html2canvas library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --primary: #10B981;
      --secondary: #059669;
      --accent: #F59E0B;
      --gradient: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      --glass: rgba(255, 255, 255, 0.98);
      --shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --radius: 16px;
      --text-primary: #1F2937;
      --text-secondary: #4B5563;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
      background: #F3F4F6;
      color: var(--text-primary);
      line-height: 1.6;
    }
    
    /* HEADER */
    .analyzer-header {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 2rem;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: sticky;
      top: 1rem;
      z-index: 100;
    }
    
    .score-display {
      display: flex;
      align-items: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }
    
    .total-score {
      font-size: 1.75rem;
      font-weight: 700;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }
    
    .controls {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px rgba(16, 185, 129, 0.15);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3);
    }
    
    /* BRAINSTORM / IDEA SECTION */
    .brainstorm-section {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      margin-bottom: 2rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .brainstorm-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .brainstorm-header h2 {
      margin: 0;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    #ideaInput {
      width: 100%;
      height: 150px;
      padding: 1.5rem;
      border: 2px solid #E5E7EB;
      border-radius: 12px;
      margin: 1rem 0;
      font-size: 1rem;
      resize: vertical;
      transition: var(--transition);
      background: rgba(249, 250, 251, 0.8);
    }
    
    #ideaInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15);
    }
    
    .idea-preview {
      background: #fff;
      border: 1px solid #E5E7EB;
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
      font-size: 1rem;
      color: var(--text-secondary);
    }
    
    .word-count {
      text-align: right;
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }
    
    .prompt-generator {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: rgba(245, 158, 11, 0.05);
      border-radius: var(--radius);
      border: 1px solid rgba(245, 158, 11, 0.1);
    }
    
    /* Revision History */
    .revision-history {
      margin-top: 1rem;
      background: #fff;
      border: 1px solid #E5E7EB;
      border-radius: var(--radius);
      padding: 0.75rem;
      max-height: 150px;
      overflow-y: auto;
      font-size: 0.9rem;
    }
    
    .revision-history li {
      cursor: pointer;
      margin: 0.25rem 0;
      padding: 0.25rem;
    }
    
    .clear-btn {
      background: #F87171;
      border: none;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    
    .clear-btn:hover {
      background: #EF4444;
    }
    
    /* RUBRIC TABLE */
    .rubric-table {
      background: var(--glass);
      border-radius: var(--radius);
      margin: 2rem 0;
      box-shadow: var(--shadow);
      overflow-x: auto;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .modern-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 800px;
    }
    
    .modern-table th {
      background: var(--gradient);
      color: white;
      padding: 1.25rem;
      font-weight: 600;
      position: sticky;
      top: 0;
      backdrop-filter: blur(10px);
    }
    
    .modern-table td {
      padding: 1.25rem;
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid rgba(229, 231, 235, 0.3);
      transition: var(--transition);
      vertical-align: top;
      min-width: 200px;
      cursor: pointer;
    }
    
    .category-header {
      font-weight: 600;
      background: rgba(16, 185, 129, 0.08);
      position: sticky;
      left: 0;
      min-width: 180px;
      backdrop-filter: blur(5px);
      border-right: 1px solid rgba(229, 231, 235, 0.3);
      /* Tooltip for additional guidance */
      cursor: help;
    }
    
    .modern-table td:not(.category-header):hover {
      background: rgba(209, 250, 229, 0.3);
      transform: scale(1.02);
    }
    
    .selected {
      background: rgba(209, 250, 229, 0.5) !important;
      box-shadow: inset 4px 0 0 var(--primary);
      transform: scale(1.02);
    }
    
    /* FEEDBACK PANEL & RESOURCES */
    .feedback-panel, .resources {
      background: var(--glass);
      padding: 2rem;
      border-radius: var(--radius);
      margin: 2rem 0;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .ai-suggestions {
      background: rgba(245, 158, 11, 0.05);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 1.5rem;
      border: 1px solid rgba(245, 158, 11, 0.1);
    }
    
    /* RESOURCES */
    .resources h3 {
      margin-top: 0;
    }
    
    .resources ul {
      margin: 1rem 0 0 1.5rem;
    }
    
    /* HOW-TO MODAL */
    .modal-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 1rem;
    }
    
    .modal-bg.show {
      display: flex;
    }
    
    .modal-content {
      position: relative;
      background: #fff;
      border-radius: var(--radius);
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      padding: 1.5rem;
    }
    
    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255,255,255,0.8);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close-btn:hover {
      background: rgba(255,255,255,1);
    }
    
    /* Loading spinner for AI suggestions */
    .loading-spinner {
      display: inline-block;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 0 1rem;
      }
      .modern-table th, .modern-table td {
        padding: 1rem;
        min-width: 160px;
      }
      .category-header {
        min-width: 140px;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="analyzer-header">
    <div class="score-display">
      <div class="total-score">Score: <span id="total">0</span>/40</div>
      <div class="status-indicator" id="ranking">Incomplete</div>
    </div>
    <div class="controls">
      <button onclick="resetScores()">üîÑ Reset Scores</button>
      <button onclick="exportPDF()">üì• Export Report</button>
      <button onclick="getAISuggestions()">ü§ñ AI Suggestions</button>
      <button onclick="openHowTo()">‚ùì How To</button>
    </div>
  </div>
  
  <!-- BRAINSTORM / IDEA SECTION -->
  <div class="brainstorm-section">
    <div class="brainstorm-header">
      <svg class="spark-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" width="28" height="28">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
      </svg>
      <h2>Idea Incubator</h2>
    </div>
    <textarea id="ideaInput" placeholder="‚ú® Describe your video concept here..."></textarea>
    <div class="word-count" id="ideaWordCount">0 words, 0 characters</div>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
      <button class="clear-btn" onclick="clearIdea()">Clear Idea</button>
      <button class="clear-btn" onclick="copyIdea()">üìã Copy Idea</button>
      <button class="clear-btn" onclick="saveRevision()">üíæ Save Revision</button>
    </div>
    <ul class="revision-history" id="revisionHistory"></ul>
    <button class="clear-btn" onclick="clearRevisions()">Clear Revision History</button>
    <div class="idea-preview" id="ideaPreview">Live Preview: Your idea will appear here as you type.</div>
    
    <div class="prompt-generator">
      <button onclick="generatePrompt()">üé≤ Random Prompt</button>
      <div id="randomPrompt" class="idea-prompt"></div>
    </div>
  </div>
  
  <!-- RUBRIC TABLE -->
  <div class="rubric-table">
    <table class="modern-table">
      <thead>
        <tr>
          <th>Category</th>
          <th>Good (1)</th>
          <th>Great (2)</th>
          <th>Excellent (3)</th>
          <th>Outstanding (4)</th>
        </tr>
      </thead>
      <tbody>
        <!-- Originality & Concept -->
        <tr>
          <td class="category-header" data-category="0" title="How unique and intriguing is the idea?">Originality &amp; Concept</td>
          <td data-category="0" data-rating="1">Basic, generic idea</td>
          <td data-category="0" data-rating="2">Some intrigue but needs refinement</td>
          <td data-category="0" data-rating="3">Engaging with clear potential</td>
          <td data-category="0" data-rating="4">Exceptionally bold &amp; entertaining</td>
        </tr>
        <!-- Transformation/Progression -->
        <tr>
          <td class="category-header" data-category="1" title="How well does the idea develop or transform?">Transformation/Progression</td>
          <td data-category="1" data-rating="1">No clear growth</td>
          <td data-category="1" data-rating="2">Mild progression</td>
          <td data-category="1" data-rating="3">Clear transformation</td>
          <td data-category="1" data-rating="4">Dramatic, impactful progression</td>
        </tr>
        <!-- Engagement Potential -->
        <tr>
          <td class="category-header" data-category="2" title="Will the idea trigger interactions?">Engagement Potential</td>
          <td data-category="2" data-rating="1">No interaction triggers</td>
          <td data-category="2" data-rating="2">Might get likes</td>
          <td data-category="2" data-rating="3">Encourages interaction</td>
          <td data-category="2" data-rating="4">High engagement factor</td>
        </tr>
        <!-- Binge & Algorithm Fuel -->
        <tr>
          <td class="category-header" data-category="3" title="Does the idea lend itself to series or algorithm boosting?">Binge &amp; Algorithm Fuel</td>
          <td data-category="3" data-rating="1">One-off video</td>
          <td data-category="3" data-rating="2">Basic teaser</td>
          <td data-category="3" data-rating="3">Multi-part cliffhanger</td>
          <td data-category="3" data-rating="4">Unfinished business hook</td>
        </tr>
        <!-- WOW Factor -->
        <tr>
          <td class="category-header" data-category="4" title="How many 'aha' moments does the idea offer?">WOW Factor</td>
          <td data-category="4" data-rating="1">Standard presentation</td>
          <td data-category="4" data-rating="2">Some cool moments</td>
          <td data-category="4" data-rating="3">Standout moments</td>
          <td data-category="4" data-rating="4">Mind-blowing moments</td>
        </tr>
        <!-- Emotional Impact -->
        <tr>
          <td class="category-header" data-category="5" title="How emotionally resonant is the idea?">Emotional Impact</td>
          <td data-category="5" data-rating="1">Flat tone</td>
          <td data-category="5" data-rating="2">Occasional laughs</td>
          <td data-category="5" data-rating="3">Emotional rollercoaster</td>
          <td data-category="5" data-rating="4">Visceral reactions</td>
        </tr>
        <!-- Trend Potential -->
        <tr>
          <td class="category-header" data-category="6" title="Does the idea tap into current or future trends?">Trend Potential</td>
          <td data-category="6" data-rating="1">Misses trends</td>
          <td data-category="6" data-rating="2">Loosely aligned</td>
          <td data-category="6" data-rating="3">Viral alignment</td>
          <td data-category="6" data-rating="4">Trend-setting</td>
        </tr>
        <!-- Replayability -->
        <tr>
          <td class="category-header" data-category="7" title="Will viewers want to revisit or share this idea?">Replayability</td>
          <td data-category="7" data-rating="1">Forgettable</td>
          <td data-category="7" data-rating="2">Somewhat shareable</td>
          <td data-category="7" data-rating="3">Highly shareable</td>
          <td data-category="7" data-rating="4">Meme-worthy</td>
        </tr>
        <!-- Audience Alignment -->
        <tr>
          <td class="category-header" data-category="8" title="How well does the idea match the target audience?">Audience Alignment</td>
          <td data-category="8" data-rating="1">Too generic</td>
          <td data-category="8" data-rating="2">Mildly resonates</td>
          <td data-category="8" data-rating="3">Clear alignment</td>
          <td data-category="8" data-rating="4">Perfect alignment</td>
        </tr>
        <!-- Execution Feasibility -->
        <tr>
          <td class="category-header" data-category="9" title="How realistic is it to execute the idea?">Execution Feasibility</td>
          <td data-category="9" data-rating="1">Impractical</td>
          <td data-category="9" data-rating="2">Possible but difficult</td>
          <td data-category="9" data-rating="3">Practical with ROI</td>
          <td data-category="9" data-rating="4">Easy &amp; high ROI</td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- FEEDBACK PANEL -->
  <div class="feedback-panel" id="feedback">
    <h3>Improvement Recommendations</h3>
    <div id="specificFeedback"></div>
    <div class="ai-suggestions" id="aiSuggestions"></div>
  </div>
  
  <!-- RESOURCES -->
  <div class="resources">
    <h3>Idea Generation Resources</h3>
    <ul>
      <li><a href="https://trends.google.com/trends/" target="_blank">Google Trends</a></li>
      <li><a href="https://answerthepublic.com/" target="_blank">Audience Questions</a></li>
      <li><a href="https://www.reddit.com/r/VideoIdeas/" target="_blank">Idea Community</a></li>
    </ul>
  </div>
  
  <!-- HOW-TO MODAL -->
  <div class="modal-bg" id="howToModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeHowTo()">‚úï</span>
      <h2>How to Use Idea Forge Pro</h2>
      <ul>
        <li>Type or paste your video concept in the Idea Incubator.</li>
        <li>Watch the live preview and word/character count update as you type.</li>
        <li>Use the "Save Revision" button to record versions of your idea.</li>
        <li>Click on a revision from the list to load it back into the editor.</li>
        <li>Generate random prompts for inspiration with the "Random Prompt" button.</li>
        <li>Rate your idea using the rubric table and review detailed improvement recommendations below.</li>
        <li>Use the AI Suggestions button for automated feedback.</li>
        <li>Export your complete report as a PDF when you‚Äôre ready.</li>
      </ul>
    </div>
  </div>
  
  <script>
    /***************************************************
     * Improvement Tips for Rubric (10 Categories)
     ***************************************************/
    const improvementTips = {
      0: {1: "Add an unexpected twist to your concept.", 2: "Combine two popular ideas for added intrigue.", 3: "Introduce a mystery element that hooks curiosity.", 4: "Your idea is exceptionally original!"},
      1: {1: "Outline a clear beginning, middle, and end.", 2: "Establish progression milestones.", 3: "Build a dramatic arc for transformation.", 4: "Perfect structure ‚Äì your idea evolves powerfully!"},
      2: {1: "Include a clear call-to-action.", 2: "Pose a provocative question to spark debate.", 3: "Design a shareable moment.", 4: "This idea is built-in for virality!"},
      3: {1: "Consider series potential.", 2: "Show character continuity.", 3: "Incorporate an unresolved mystery.", 4: "This idea begs for binge-watching!"},
      4: {1: "Add a visual spectacle.", 2: "Include a surprising element.", 3: "Create that 'holy cow' moment.", 4: "Multiple WOW factors present!"},
      5: {1: "Include a personal anecdote.", 2: "Showcase triumphs or failures.", 3: "Build suspense.", 4: "This will take viewers on an emotional rollercoaster!"},
      6: {1: "Research current trends.", 2: "Incorporate trending audio or memes.", 3: "Anticipate the next big trend.", 4: "Your idea is trend-setting!"},
      7: {1: "Use a popular meme template.", 2: "Craft a quotable moment.", 3: "Include an inside joke.", 4: "This idea has built-in replay value!"},
      8: {1: "Analyze your target demographics.", 2: "Check community polls.", 3: "Align with top-performing content.", 4: "Perfect audience match!"},
      9: {1: "Simplify production needs.", 2: "Find cost-effective solutions.", 3: "Plan resource allocation carefully.", 4: "Optimal execution with high ROI!"}
    };
    
    /***************************************************
     * Global Variables & Revision History
     ***************************************************/
    let scores = {};
    let revisions = [];
    let saveDraftTimeout;
    
    const prompts = [
      "What if you combined [trend1] with [unexpected element]?",
      "How would [famous person] approach [common problem]?",
      "The ultimate challenge: [difficult task] in 24 hours",
      "Mystery box challenge with [twist]",
      "Testing viral [hack/myth] with a scientific approach"
    ];
    
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved draft (if any)
      const savedDraft = localStorage.getItem('ideaDraft');
      if(savedDraft) {
        document.getElementById('ideaInput').value = savedDraft;
        updateIdea();
      }
      // Load saved revisions
      const savedRevisions = localStorage.getItem('ideaRevisions');
      if(savedRevisions) {
        revisions = JSON.parse(savedRevisions);
        updateRevisionHistory();
      }
      // Set up event listeners
      document.querySelectorAll('.modern-table td[data-rating]').forEach(cell => {
        cell.addEventListener('click', () => selectRating(cell));
      });
      document.getElementById('ideaInput').addEventListener('input', updateIdea);
      generatePrompt();
      
      // Close How-To modal on Escape key press
      document.addEventListener('keydown', function(e) {
        if(e.key === "Escape" && document.getElementById('howToModal').classList.contains('show')) {
          closeHowTo();
        }
      });
    });
    
    /***************************************************
     * Rubric Score Functions
     ***************************************************/
    function selectRating(cell) {
      const categoryIndex = Number(cell.getAttribute('data-category'));
      const rating = parseInt(cell.getAttribute('data-rating'));
      const row = cell.parentElement;
      row.querySelectorAll('td').forEach(td => {
        if(td !== row.firstElementChild) td.classList.remove('selected');
      });
      cell.classList.add('selected');
      scores[categoryIndex] = rating;
      updateTotal();
      showFeedback();
    }
    
    function updateTotal() {
      const total = Object.values(scores).reduce((a, b) => a + b, 0);
      document.getElementById('total').textContent = total;
      const ranking = document.getElementById('ranking');
      
      if(Object.keys(scores).length < 10) {
        ranking.textContent = 'Incomplete';
        ranking.style.color = '#64748b';
        return;
      }
      
      if(total <= 24) {
        ranking.textContent = 'Needs Work üî¥';
        ranking.style.color = '#ef4444';
      } else if(total <= 32) {
        ranking.textContent = 'Good Start üü°';
        ranking.style.color = '#eab308';
      } else if(total <= 38) {
        ranking.textContent = 'Great! üü¢';
        ranking.style.color = '#22c55e';
      } else {
        ranking.textContent = 'Perfect! üîµ';
        ranking.style.color = '#3b82f6';
      }
    }
    
    function showFeedback() {
      const feedbackDiv = document.getElementById('specificFeedback');
      feedbackDiv.innerHTML = Object.keys(scores).map(cat => {
        const rating = scores[cat];
        // Look up the category header using the data-category attribute
        const header = document.querySelector(`.category-header[data-category="${cat}"]`);
        const categoryName = header ? header.textContent.trim() : 'Category ' + cat;
        return `<div class="feedback-item" style="margin: 0.5rem 0; padding: 1rem; background: rgba(16, 185, 129, 0.05); border-radius: 8px;">
                  <strong style="color: ${getCategoryColor(cat)}">${categoryName}:</strong>
                  <span style="color: #475569;"> ${improvementTips[cat][rating]}</span>
                </div>`;
      }).join('');
    }
    
    function getCategoryColor(cat) {
      const colors = ['#10B981', '#F59E0B', '#3B82F6', '#8B5CF6', '#EC4899', 
                      '#EF4444', '#14B8A6', '#84CC16', '#64748B', '#6366F1'];
      return colors[Number(cat)];
    }
    
    function resetScores() {
      scores = {};
      document.querySelectorAll('.selected').forEach(cell => cell.classList.remove('selected'));
      document.getElementById('specificFeedback').innerHTML = '';
      updateTotal();
      document.getElementById('ranking').textContent = 'Incomplete';
      document.getElementById('ranking').style.color = '#64748b';
    }
    
    /***************************************************
     * Prompt Generator
     ***************************************************/
    function generatePrompt() {
      const random = prompts[Math.floor(Math.random() * prompts.length)];
      document.getElementById('randomPrompt').textContent = random;
    }
    
    /***************************************************
     * Idea Input: Live Word/Character Count, Preview & Auto-save Draft
     ***************************************************/
    function updateIdea() {
      const ideaText = document.getElementById('ideaInput').value;
      updateWordCount(ideaText);
      updateIdeaPreview(ideaText);
      // Auto-save draft after 500ms of inactivity
      clearTimeout(saveDraftTimeout);
      saveDraftTimeout = setTimeout(() => {
        localStorage.setItem('ideaDraft', ideaText);
      }, 500);
    }
    
    function updateWordCount(text) {
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      const characters = text.length;
      document.getElementById('ideaWordCount').textContent = `${words} words, ${characters} characters`;
    }
    
    function updateIdeaPreview(text) {
      const preview = text ? text.replace(/\n/g, '<br>') : "Live Preview: Your idea will appear here as you type.";
      document.getElementById('ideaPreview').innerHTML = preview;
    }
    
    function clearIdea() {
      document.getElementById('ideaInput').value = '';
      updateIdea();
    }
    
    function saveRevision() {
      const ideaText = document.getElementById('ideaInput').value;
      if(!ideaText.trim()) return;
      const timestamp = new Date().toLocaleString();
      revisions.push({ text: ideaText, time: timestamp });
      localStorage.setItem('ideaRevisions', JSON.stringify(revisions));
      updateRevisionHistory();
    }
    
    function updateRevisionHistory() {
      const revList = document.getElementById('revisionHistory');
      revList.innerHTML = revisions.map((rev, index) => `<li onclick="loadRevision(${index})">Revision ${index+1} - ${rev.time}</li>`).join('');
    }
    
    function loadRevision(index) {
      if(confirm("Load this revision? Unsaved changes will be lost.")) {
        document.getElementById('ideaInput').value = revisions[index].text;
        updateIdea();
      }
    }
    
    function clearRevisions() {
      if(confirm("Are you sure you want to clear all revision history?")) {
        revisions = [];
        updateRevisionHistory();
        localStorage.removeItem('ideaRevisions');
      }
    }
    
    /***************************************************
     * AI Suggestions Simulation
     ***************************************************/
    async function getAISuggestions() {
      const aiDiv = document.getElementById('aiSuggestions');
      aiDiv.innerHTML = '<div class="loading-spinner">‚è≥</div> Analyzing concept...';
      setTimeout(() => {
        const suggestions = [
          "Add a personal story to increase relatability.",
          "Include a surprising twist in the first 30 seconds.",
          "Create a recurring character for series potential.",
          "Add data visualization for credibility.",
          "Use trending audio to boost discoverability."
        ];
        aiDiv.innerHTML = '<strong>AI Recommendations:</strong><br>' + suggestions.map(s => `‚Ä¢ ${s}`).join('<br>');
      }, 2000);
    }
    
    /***************************************************
     * EXPORT PDF
     ***************************************************/
    async function exportPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const elements = [
          document.querySelector('.analyzer-header'),
          document.querySelector('.brainstorm-section'),
          document.querySelector('.rubric-table'),
          document.querySelector('.feedback-panel')
        ];
        
        let yPos = 10;
        for(const element of elements) {
          const canvas = await html2canvas(element, { scale: 2 });
          const imgData = canvas.toDataURL('image/png');
          const imgProps = doc.getImageProperties(imgData);
          const pdfWidth = doc.internal.pageSize.getWidth() - 20;
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          if(yPos + pdfHeight > doc.internal.pageSize.getHeight()) {
            doc.addPage();
            yPos = 10;
          }
          doc.addImage(imgData, 'PNG', 10, yPos, pdfWidth, pdfHeight);
          yPos += pdfHeight + 10;
        }
        doc.save('idea-analysis-report.pdf');
      } catch (error) {
        console.error("Error exporting PDF: ", error);
        alert("Failed to export PDF. Please try again.");
      }
    }
    
    /***************************************************
     * HOW-TO MODAL FUNCTIONS
     ***************************************************/
    function openHowTo() {
      document.getElementById('howToModal').classList.add('show');
    }
    
    function closeHowTo() {
      document.getElementById('howToModal').classList.remove('show');
    }
    
    /***************************************************
     * Copy Idea Functionality
     ***************************************************/
    function copyIdea() {
      const ideaText = document.getElementById('ideaInput').value;
      if(ideaText.trim()) {
        navigator.clipboard.writeText(ideaText)
          .then(() => alert('Idea copied to clipboard!'))
          .catch(err => alert('Failed to copy text: ' + err));
      }
    }
  </script>
</body>
</html>
